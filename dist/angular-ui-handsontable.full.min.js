/**
 * angular-ui-handsontable 0.1.2-dev
 * 
 * Date: Thu Nov 15 2012 13:53:49 GMT+0100 (Central European Standard Time)
*/
document.all&&!document.addEventListener&&(document.createElement("ui-handsontable"),document.createElement("datacolumn"),document.createElement("optionlist")),angular.module("ui.directives",[]).directive("uiHandsontable",function(){var e={restrict:"EA",compile:function(t,n,r){var i={startRows:0,startCols:3,outsideClickDeselects:!1,autoComplete:[]},s=$('<div class="ui-handsontable-container"></div>'),o=n.datarows,u=o.match(/^\s*(.+)\s+in\s+(.*)\s*$/),a,f;if(!u)throw Error("Expected datarows in form of '_item_ in _collection_' but got '"+o+"'.");return a=u[1],f=u[2],t.data("uiDatagrid",{lhs:a,rhs:f,colHeaders:[],columns:[],settings:angular.extend({},i),$container:s}),function(t,n,r,i){var o=n.data("uiDatagrid");o.settings=angular.extend(o.settings,t.$eval(r.uiHandsontable||r.settings)),$(n).append(s),typeof t[f]!="undefined"&&(o.settings.data=t[f],o.columns.length>0&&(o.settings.columns=o.columns,o.settings.startCols=o.columns.length)),o.colHeaders.length>0&&(o.settings.colHeaders=o.colHeaders),s.handsontable(o.settings),s.on("datachange.handsontable",function(e,n,r){t.$$phase||t.$apply()}),s.on("selectionbyprop.handsontable",function(e,n,r,i,o){t.$emit("datagridSelection",s,n,r,i,o)}),t.$watch(f,function(e){t[f]!==s.handsontable("getData")&&o.columns.length>0?s.handsontable("updateSettings",{data:t[f],columns:o.columns,startCols:o.columns.length}):s.handsontable("loadData",t[f])},!0)}}};return e}).directive("datacolumn",function(){var e={restrict:"E",priority:500,compile:function(t,n,r){var i=[];for(var s in n)n.hasOwnProperty(s)&&i.push(s);return t.data("uiDatagridAutocomplete",{value:n.value,source:null,live:$.inArray("live",i)!==-1,strict:$.inArray("strict",i)!==-1}),function(t,n,r,i){var s,o=n.inheritedData("uiDatagrid"),u=new RegExp("^("+o.lhs+"\\.)"),a=r.value.replace(u,""),f=t.$eval(r.title),l=t.$eval(r.type),c=r.options,h,p=t.$new(),d=t.$eval(c)||{};d.data=a,o.colHeaders.push(f);switch(l){case"autocomplete":d.type=Handsontable.AutocompleteCell;var v=n.data("uiDatagridAutocomplete");for(s in v)v.hasOwnProperty(s)&&(d[s]=v[s]);break;case"checkbox":d.type=Handsontable.CheckboxCell,h=r.checkedtemplate,typeof h!="undefined"&&(d.checkedTemplate=t.$eval(h)),h=r.uncheckedtemplate,typeof h!="undefined"&&(d.uncheckedTemplate=t.$eval(h));break;default:typeof l=="object"&&(d.type=l)}typeof r.readonly!="undefined"&&(d.readOnly=!0);for(s in r)r.hasOwnProperty(s)&&s.charAt(0)!=="$"&&typeof d[s]=="undefined"&&(d[s]=p.$eval(r[s]));o.columns.push(d)}}};return e}).directive("optionlist",function(){var e={restrict:"E",transclude:"element",priority:510,compile:function(t,n,r){return function(t,n,i,s){var o=n.inheritedData("uiDatagridAutocomplete"),u=n.inheritedData("uiDatagrid"),a=i.datarows,f=a.match(/^\s*(.+)\s+in\s+(.*)\s*$/),l,c;if(!f)throw Error("Expected datarows in form of '_item_ in _collection_' but got '"+a+"'.");l=f[1],c=f[2];var h,p,d=t.$new(),v,m;o.source=function(e,n){if($.trim(e)===m)return;m=$.trim(e),h&&(h(),clearInterval(p));var r=u.$container.data("handsontable").getSelected()[0];d[u.lhs]=t.$eval(u.rhs)[r],o.live&&(d.$eval(o.value+' = "'+$.trim(e).replace(/"/g,'"')+'"'),d.$digest()),p=setInterval(function(){t.currentItem=d.item=u.$container.data("handsontable").getData()[r],t.$digest(),d.$digest()},100),h=d.$watch(c,function(e){v=e,n&&n(e)},!0)},o.sorter=function(e){return e},o.highlighter=function(e){var t,n=d.$new();return n[l]=e,r(n,function(e){t=e[0],t.style.display="block"}),t},o.select=function(){var e=u.$container.data("handsontable");if(this.$menu.find(".active").length){var t=this.$menu.find(".active").index();d[l]=v[t],e.destroyEditor(),d.$eval(i.clickrow)}else o.strict||(e.destroyEditor(),d.$eval(o.value+' = "'+$.trim(this.query).replace(/"/g,'"')+'"'));return m=void 0,this.hide()}}}};return e});var Handsontable={extension:{},helper:{}};(function(e,t,n){"use strict";function s(e){var t=e.data("typeahead");return t&&t.$menu.is(":visible")?t:!1}function o(e,t,r,i){n.helper.stringify(e.getDataAtCell(t,r))===n.helper.stringify(i.checkedTemplate)?e.setDataAtCell(t,r,i.uncheckedTemplate):e.setDataAtCell(t,r,i.checkedTemplate)}function u(){function a(e){var n=t.getSelected();switch(e){case"row_above":t.alter("insert_row",n[0]);break;case"row_below":t.alter("insert_row",n[2]+1);break;case"col_left":t.alter("insert_col",n[1]);break;case"col_right":t.alter("insert_col",n[3]+1);break;case"remove_row":t.alter(e,n[0],n[2]);break;case"remove_col":t.alter(e,n[1],n[3]);break;case"undo":t.undo();break;case"redo":t.redo()}}function f(e){return!t.blockedCols.main.find("th.htRowHeader.active").length||e!=="remove_col"&&e!=="col_left"&&e!=="col_right"?!t.blockedRows.main.find("th.htColHeader.active").length||e!=="remove_row"&&e!=="row_above"&&e!=="row_below"?!1:!0:!0}var t=this,n={selector:"#"+t.rootElement.attr("id")+" table, #"+t.rootElement.attr("id")+" div",trigger:"right",callback:a},r={row_above:{name:"Insert row above",disabled:f},row_below:{name:"Insert row below",disabled:f},hsep1:"---------",col_left:{name:"Insert column on the left",disabled:f},col_right:{name:"Insert column on the right",disabled:f},hsep2:"---------",remove_row:{name:"Remove row",disabled:f},remove_col:{name:"Remove column",disabled:f},hsep3:"---------",undo:{name:"Undo",disabled:function(){return!t.isUndoAvailable()}},redo:{name:"Redo",disabled:function(){return!t.isRedoAvailable()}}},i={},s,o,u=t.getSettings();if(!u.contextMenu)return;if(u.contextMenu===!0)i.items=r;else if(Object.prototype.toString.apply(u.contextMenu)==="[object Array]"){i.items={};for(s=0,o=u.contextMenu.length;s<o;s++){var l=u.contextMenu[s];if(typeof r[l]=="undefined")throw new Error('Context menu key "'+l+'" is not recognised');i.items[l]=r[l]}}else if(Object.prototype.toString.apply(u.contextMenu)==="[object Object]"){i=u.contextMenu;if(i.items)for(s in i.items)i.items.hasOwnProperty(s)&&r[s]&&(typeof i.items[s]=="string"?i.items[s]=r[s]:i.items[s]=e.extend(!0,r[s],i.items[s]));else i.items=r;if(i.callback){var c=n.callback,h=i.callback;i.callback=function(e,t){c(e,t),h(e,t)}}}if(!t.rootElement.attr("id"))throw new Error("Handsontable container must have an id");e.contextMenu(e.extend(!0,n,i))}n.Core=function(t,r){this.rootElement=t;var i,s,o,u,a,f,l,c,h=this;i={settings:{},selStart:null,selEnd:null,editProxy:!1,isPopulated:null,scrollable:null,undoRedo:null,extensions:{},colToProp:[],propToCol:{},dataSchema:null,dataType:"array"};var p=e.browser.msie&&parseInt(e.browser.version,10)<=7;this.minWidthFix=function(e){p&&(e.className?e.innerHTML='<div class="minWidthFix '+e.className+'">'+e.innerHTML+"</div>":e.innerHTML='<div class="minWidthFix">'+e.innerHTML+"</div>")};var d=e.browser.msie&&parseInt(e.browser.version,10)<=7;this.positionFix=function(e){d&&(e.top<0&&(e.top=0),e.left<0&&(e.left=0))},s={recursiveDuckSchema:function(t){var n;if(e.isPlainObject(t)){n={};for(var r in t)t.hasOwnProperty(r)&&(e.isPlainObject(t[r])?n[r]=s.recursiveDuckSchema(t[r]):n[r]=null)}else n=[];return n},recursiveDuckColumns:function(t,n,r){var o,u;typeof n=="undefined"&&(n=0,r="");if(e.isPlainObject(t))for(u in t)t.hasOwnProperty(u)&&(t[u]===null?(o=r+u,i.colToProp.push(o),i.propToCol[o]=n,n++):n=s.recursiveDuckColumns(t[u],n,u+"."));return n},createMap:function(){if(typeof s.getSchema()=="undefined")throw new Error("trying to create `columns` definition but you didnt' provide `schema` nor `data`");var e,t,n=s.getSchema();i.colToProp=[],i.propToCol={};if(i.settings.columns)for(e=0,t=i.settings.columns.length;e<t;e++)i.colToProp[e]=i.settings.columns[e].data,i.propToCol[i.settings.columns[e].data]=e;else s.recursiveDuckColumns(n)},colToProp:function(e){return typeof i.colToProp[e]!="undefined"?i.colToProp[e]:e},propToCol:function(e){return typeof i.propToCol[e]!="undefined"?i.propToCol[e]:e},getSchema:function(){return i.settings.dataSchema||i.duckDataSchema},createRow:function(t){var n;if(i.dataType==="array"){n=[];for(var r=0;r<h.colCount;r++)n.push(null)}else n=e.extend(!0,{},s.getSchema());!t||t.row>=h.rowCount?i.settings.data.push(n):i.settings.data.splice(t.row,0,n)},createCol:function(e){if(i.dataType==="object"||i.settings.columns)throw new Error("cannot create column with object data source or columns option specified");var t=0;if(!e||e.col>=h.colCount)for(;t<h.rowCount;t++)typeof i.settings.data[t]=="undefined"&&(i.settings.data[t]=[]),i.settings.data[t].push("");else for(;t<h.rowCount;t++)i.settings.data[t].splice(e.col,0,"")},removeRow:function(e,t){!e||e.row===h.rowCount-1?i.settings.data.pop():i.settings.data.splice(e.row,t.row-e.row+1)},removeCol:function(e,t){if(i.dataType==="object"||i.settings.columns)throw new Error("cannot remove column with object data source or columns option specified");var n=0;if(!e||e.col===h.colCount-1)for(;n<h.rowCount;n++)i.settings.data[n].pop();else{var r=t.col-e.col+1;for(;n<h.rowCount;n++)i.settings.data[n].splice(e.col,r)}},get:function(e,t){if(typeof t=="string"&&t.indexOf(".")>-1){var n=t.split("."),r=i.settings.data[e];for(var s=0,o=n.length;s<o;s++){r=r[n[s]];if(typeof r=="undefined")return null}return r}return i.settings.data[e]?i.settings.data[e][t]:null},set:function(e,t,n){if(typeof t=="string"&&t.indexOf(".")>-1){var r=t.split("."),s=i.settings.data[e];for(var o=0,u=r.length-1;o<u;o++)s=s[r[o]];s[r[o]]=n}else i.settings.data[e][t]=n},clear:function(){for(var e=0;e<h.rowCount;e++)for(var t=0;t<h.colCount;t++)s.set(e,s.colToProp(t),"")},getAll:function(){return i.settings.data},getRange:function(e,t){var n,r,i,o,u=[],a;r=Math.max(e.row,t.row),o=Math.max(e.col,t.col);for(n=Math.min(e.row,t.row);n<=r;n++){a=[];for(i=Math.min(e.col,t.col);i<=o;i++)a.push(s.get(n,s.colToProp(i)));u.push(a)}return u},getText:function(e,t){return SheetClip.stringify(s.getRange(e,t))}},o={alter:function(t,n,r){var a,f,l,c,p,d,v,m;a=e.extend(!0,[],s.getAll());switch(t){case"insert_row":s.createRow(n),h.view.createRow(n),h.view.renderRow(n.row),h.blockedCols.refresh(),i.selStart&&i.selStart.row>=n.row?(i.selStart.row=i.selStart.row+1,u.transformEnd(1,0)):u.transformEnd(0,0);break;case"insert_col":s.createCol(n),h.view.createCol(n),h.view.renderCol(n.col),h.blockedRows.refresh(),i.selStart&&i.selStart.col>=n.col?(i.selStart.col=i.selStart.col+1,u.transformEnd(0,1)):u.transformEnd(0,0);break;case"remove_row":s.removeRow(n,r),h.view.removeRow(n,r),m=o.keepEmptyRows(),m||h.blockedCols.refresh(),u.transformEnd(0,0);break;case"remove_col":s.removeCol(n,r),h.view.removeCol(n,r),m=o.keepEmptyRows(),m||h.blockedRows.refresh(),u.transformEnd(0,0)}l=[],f=s.getAll();for(c=0,p=f.length;c<p;c++)for(d=0,v=f[c].length;d<v;d++)l.push([c,d,a[c]?a[c][d]:null,f[c][d]]);h.rootElement.triggerHandler("datachange.handsontable",[l,"alter"])},keepEmptyRows:function(){var t,n,r,o,a=0,f=0,l=!1,c=!1,p,d=e(i.tableBody);e:for(t=h.countRows()-1;t>=0;t--){for(n=0,o=h.colCount;n<o;n++){p=s.get(t,s.colToProp(n));if(p!==""&&p!==null&&typeof p!="undefined")break e}a++}r=h.countRows();if(r<i.settings.startRows)for(t=0;t<i.settings.startRows-r;t++)s.createRow();if(h.rowCount<i.settings.startRows)for(;h.rowCount<i.settings.startRows;a++)h.view.createRow(),h.view.renderRow(h.rowCount-1),l=!0;if(a<i.settings.minSpareRows)for(;a<i.settings.minSpareRows;a++)s.createRow(),h.view.createRow(),h.view.renderRow(h.rowCount-1),l=!0;if(i.settings.minHeight&&d.height()>0&&d.height()<=i.settings.minHeight)while(d.height()<=i.settings.minHeight)s.createRow(),h.view.createRow(),h.view.renderRow(h.rowCount-1),l=!0;if(h.countRows()-1>0)t:for(n=h.colCount-1;n>=0;n--){for(t=0;t<h.countRows();t++){p=s.get(t,s.colToProp(n));if(p!==""&&p!==null&&typeof p!="undefined")break t}f++}if(h.colCount<i.settings.startCols)for(;h.colCount<i.settings.startCols;f++)i.settings.columns||s.createCol(),h.view.createCol(),h.view.renderCol(h.colCount-1),c=!0;if(i.dataType==="array"&&f<i.settings.minSpareCols)for(;f<i.settings.minSpareCols;f++)i.settings.columns||s.createCol(),h.view.createCol(),h.view.renderCol(h.colCount-1),c=!0;if(i.settings.minWidth&&d.width()>0&&d.width()<=i.settings.minWidth)while(d.width()<=i.settings.minWidth)i.settings.columns||s.createCol(),h.view.createCol(),h.view.renderCol(h.colCount-1),c=!0;if(!l&&i.settings.enterBeginsEditing)for(;i.settings.startRows&&h.rowCount>i.settings.startRows&&i.settings.minSpareRows&&a>i.settings.minSpareRows&&(!i.settings.minHeight||d.height()-d.find("tr:last").height()-4>i.settings.minHeight);a--)h.view.removeRow(),s.removeRow(),l=!0;l&&i.selStart&&(i.selStart.row>h.rowCount-1?(i.selStart.row=h.rowCount-1,i.selEnd.row>i.selStart.row&&(i.selEnd.row=i.selStart.row)):i.selEnd.row>h.rowCount-1&&(i.selEnd.row=h.rowCount-1,i.selStart.row>i.selEnd.row&&(i.selStart.row=i.selEnd.row)));if(i.settings.columns&&i.settings.columns.length){o=i.settings.columns.length;if(h.colCount!==o){while(h.colCount>o)h.view.removeCol();while(h.colCount<o)h.view.createCol(),h.view.renderCol(h.colCount-1);c=!0}}else if(!c&&i.settings.enterBeginsEditing)for(;i.settings.startCols&&h.colCount>i.settings.startCols&&i.settings.minSpareCols&&f>i.settings.minSpareCols&&(!i.settings.minWidth||d.width()-d.find("tr:last").find("td:last").width()-4>i.settings.minWidth);f--)i.settings.columns||s.removeCol(),h.view.removeCol(),c=!0;c&&i.selStart&&(i.selStart.col>h.colCount-1?(i.selStart.col=h.colCount-1,i.selEnd.col>i.selStart.col&&(i.selEnd.col=i.selStart.col)):i.selEnd.col>h.colCount-1&&(i.selEnd.col=h.colCount-1,i.selStart.col>i.selEnd.col&&(i.selStart.col=i.selEnd.col)));if(l||c)u.refreshBorders(),h.blockedCols.refresh(),h.blockedRows.refresh();return l||c},isCellWritable:function(e,t){if(i.isPopulated){var n=e.data("readOnly");return typeof n=="undefined"?!t.readOnly:!n}return!0},populateFromArray:function(e,t,n,r){var o,u,a,f,l,c=[],p={};u=t.length;if(u===0)return!1;p.row=e.row,p.col=e.col;for(o=0;o<u;o++){if(n&&p.row>n.row||!i.settings.minSpareRows&&p.row>h.rowCount-1)break;p.col=e.col,f=t[o]?t[o].length:0;for(a=0;a<f;a++){if(n&&p.col>n.col||!i.settings.minSpareCols&&p.col>h.colCount-1)break;l=h.view.getCellAtCoords(p);if(h.getCellMeta(p.row,p.col).isWritable){var d=s.colToProp(p.col);c.push([p.row,d,t[o][a]])}p.col++,n&&a===f-1&&(a=-1)}p.row++,n&&o===u-1&&(o=-1)}h.setDataAtCell(c,null,null,r||"populateFromArray")},clear:function(){var t=h.view.getAllCells();for(var n=0,r=t.length;n<r;n++)e(t[n]).empty(),h.minWidthFix(t[n])},getCornerCoords:function(t){function n(t,n,r){function i(e){return e[r]}return Array.prototype.map?t.apply(Math,n.map(i)):t.apply(Math,e.map(n,i))}return{TL:{row:n(Math.min,t,"row"),col:n(Math.min,t,"col")},BR:{row:n(Math.max,t,"row"),col:n(Math.max,t,"col")}}},getCellsAtCoords:function(e,t){var n=o.getCornerCoords([e,t]),r,i,s=[];for(r=n.TL.row;r<=n.BR.row;r++)for(i=n.TL.col;i<=n.BR.col;i++)s.push(h.view.getCellAtCoords({row:r,col:i}));return s}},this.selection=u={setRangeStart:function(e){u.deselect(),i.selStart=h.view.getCellCoords(e),u.setRangeEnd(e)},setRangeEnd:function(e,t){var n=h.view.getCellCoords(e);u.end(n),i.settings.multiSelect||(i.selStart=n),h.rootElement.triggerHandler("selection.handsontable",[i.selStart.row,i.selStart.col,i.selEnd.row,i.selEnd.col]),h.rootElement.triggerHandler("selectionbyprop.handsontable",[i.selStart.row,s.colToProp(i.selStart.col),i.selEnd.row,s.colToProp(i.selEnd.col)]),u.refreshBorders(),t!==!1&&h.view.scrollViewport(e)},refreshBorders:function(e){a.destroy(e);if(!u.isSelected())return;l.handle&&l.showHandle(),i.currentBorder.appear([i.selStart]),f.on(),a.prepare()},start:function(e){return typeof e!="undefined"&&(i.selStart=e),i.selStart},end:function(e){return typeof e!="undefined"&&(i.selEnd=e),i.selEnd},isMultiple:function(){return i.selEnd.col!==i.selStart.col||i.selEnd.row!==i.selStart.row},transformStart:function(e,t,n){i.selStart.row+e>h.rowCount-1?n&&i.settings.minSpareRows>0?h.alter("insert_row",h.rowCount):i.settings.autoWrapCol&&i.selStart.col+t<h.colCount-1&&(e=1-h.rowCount,t=1):i.settings.autoWrapCol&&i.selStart.row+e<0&&i.selStart.col+t>=0&&(e=h.rowCount-1,t=-1),i.selStart.col+t>h.colCount-1?n&&i.settings.minSpareCols>0?h.alter("insert_col",h.colCount):i.settings.autoWrapRow&&i.selStart.row+e<h.rowCount-1&&(e=1,t=1-h.colCount):i.settings.autoWrapRow&&i.selStart.col+t<0&&i.selStart.row+e>=0&&(e=-1,t=h.colCount-1);var r=h.view.getCellAtCoords({row:i.selStart.row+e,col:i.selStart.col+t});r?u.setRangeStart(r):u.setRangeStart(h.view.getCellAtCoords(i.selStart))},transformEnd:function(e,t){if(i.selEnd){var n=h.view.getCellAtCoords({row:i.selEnd.row+e,col:i.selEnd.col+t});n&&u.setRangeEnd(n)}},isSelected:function(){var e=u.end();return!e||typeof e.row=="undefined"?!1:!0},inInSelection:function(e){if(!u.isSelected())return!1;var t=o.getCornerCoords([i.selStart,i.selEnd]);return t.TL.row<=e.row&&t.BR.row>=e.row&&t.TL.col<=e.col&&t.BR.col>=e.col},deselect:function(){if(!u.isSelected())return;f.off(),i.currentBorder.disappear(),l.handle&&l.hideHandle(),u.end(!1),a.destroy(),h.rootElement.triggerHandler("deselect.handsontable")},selectAll:function(){if(!i.settings.multiSelect)return;var e=h.view.getAllCells();e.length&&(u.setRangeStart(e[0]),u.setRangeEnd(e[e.length-1],!1))},empty:function(){if(!u.isSelected())return;var e=o.getCornerCoords([i.selStart,u.end()]),t,n,r=[];for(t=e.TL.row;t<=e.BR.row;t++)for(n=e.TL.col;n<=e.BR.col;n++)h.getCellMeta(t,n).isWritable&&r.push([t,s.colToProp(n),""]);h.setDataAtCell(r)}},f={init:function(){i.selectionBorder=new n.Border(h,{className:"selection",bg:!0})},on:function(){if(!u.isSelected())return!1;u.isMultiple()?i.selectionBorder.appear([i.selStart,u.end()]):i.selectionBorder.disappear()},off:function(){if(!u.isSelected())return!1;i.selectionBorder.disappear()}},this.autofill=l={handle:null,fillBorder:null,init:function(){l.handle?(l.handle.disabled=!1,l.fillBorder.disabled=!1):(l.handle=new n.FillHandle(h),l.fillBorder=new n.Border(h,{className:"htFillBorder"}),e(l.handle.handle).on("dblclick",l.selectAdjacent)),h.rootElement.on("beginediting.handsontable",function(){l.hideHandle()}),h.rootElement.on("finishediting.handsontable",function(){u.isSelected()&&l.showHandle()})},disable:function(){l.handle.disabled=!0,l.fillBorder.disabled=!0},selectAdjacent:function(){var e,t,n,r,o;u.isMultiple()?e=i.selectionBorder.corners:e=i.currentBorder.corners,l.fillBorder.disappear(),t=s.getAll();e:for(n=e.BR.row+1;n<h.rowCount;n++){for(o=e.TL.col;o<=e.BR.col;o++)if(t[n][o])break e;if(!!t[n][e.TL.col-1]||!!t[n][e.BR.col+1])r=n}r&&(l.showBorder(h.view.getCellAtCoords({row:r,col:e.BR.col})),l.apply())},apply:function(){var e,t,n,r;l.handle.isDragged=0,e=l.fillBorder.corners;if(!e)return;l.fillBorder.disappear(),u.isMultiple()?t=i.selectionBorder.corners:t=i.currentBorder.corners,e.TL.row===t.TL.row&&e.TL.col<t.TL.col?(n=e.TL,r={row:e.BR.row,col:t.TL.col-1}):e.TL.row===t.TL.row&&e.BR.col>t.BR.col?(n={row:e.TL.row,col:t.BR.col+1},r=e.BR):e.TL.row<t.TL.row&&e.TL.col===t.TL.col?(n=e.TL,r={row:t.TL.row-1,col:e.BR.col}):e.BR.row>t.BR.row&&e.TL.col===t.TL.col&&(n={row:t.BR.row+1,col:e.TL.col},r=e.BR),n?(o.populateFromArray(n,SheetClip.parse(i.editProxy.val()),r,"autofill"),u.setRangeStart(h.view.getCellAtCoords(e.TL)),u.setRangeEnd(h.view.getCellAtCoords(e.BR))):u.refreshBorders()},showHandle:function(){l.handle.appear([i.selStart,i.selEnd])},hideHandle:function(){l.handle.disappear()},showBorder:function(e){var t=h.view.getCellCoords(e),n=o.getCornerCoords([i.selStart,i.selEnd]);if(i.settings.fillHandle!=="horizontal"&&(n.BR.row<t.row||n.TL.row>t.row))t={row:t.row,col:n.BR.col};else{if(i.settings.fillHandle==="vertical")return;t={row:n.BR.row,col:t.col}}l.fillBorder.appear([i.selStart,i.selEnd,t])}},this.editproxy=a={init:function(){function t(e){e.stopPropagation()}function r(){setTimeout(function(){u.empty()},100)}function s(){setTimeout(function(){h.rootElement.one("datachange.handsontable",function(e,t,n){if(t.length){var r=t[t.length-1],i=h.view.getCellAtCoords({row:r[0],col:r[1]});u.setRangeEnd(i)}});var e=i.editProxy.val().replace(/^[\r\n]*/g,"").replace(/[\r\n]*$/g,""),t=SheetClip.parse(e),n=o.getCornerCoords([i.selStart,i.selEnd]);o.populateFromArray(n.TL,t,{row:Math.max(n.BR.row,t.length-1+n.TL.row),col:Math.max(n.BR.col,t[0].length-1+n.TL.col)},"paste")},100)}function f(t){if(a.children(".context-menu-list:visible").length)return;i.lastKeyCode=t.keyCode;if(u.isSelected()){var r=(t.ctrlKey||t.metaKey)&&!t.altKey;if(n.helper.isPrintableChar(t.keyCode)&&r){t.keyCode===65?u.selectAll():t.keyCode===88&&e.browser.opera?i.editProxyHolder.triggerHandler("cut"):t.keyCode===86&&e.browser.opera?i.editProxyHolder.triggerHandler("paste"):t.keyCode===89||t.shiftKey&&t.keyCode===90?i.undoRedo&&i.undoRedo.redo():t.keyCode===90&&i.undoRedo&&i.undoRedo.undo();return}var s=t.shiftKey?u.setRangeEnd:u.setRangeStart;switch(t.keyCode){case 38:t.shiftKey?u.transformEnd(-1,0):u.transformStart(-1,0),t.preventDefault();break;case 9:var o=typeof i.settings.tabMoves=="function"?i.settings.tabMoves(t):i.settings.tabMoves;t.shiftKey?u.transformStart(-o.row,-o.col):u.transformStart(o.row,o.col),t.preventDefault();break;case 39:t.shiftKey?u.transformEnd(0,1):u.transformStart(0,1),t.preventDefault();break;case 37:t.shiftKey?u.transformEnd(0,-1):u.transformStart(0,-1),t.preventDefault();break;case 8:case 46:u.empty(t),t.preventDefault();break;case 40:t.shiftKey?u.transformEnd(1,0):u.transformStart(1,0),t.preventDefault();break;case 113:t.preventDefault();break;case 13:var f=typeof i.settings.enterMoves=="function"?i.settings.enterMoves(t):i.settings.enterMoves;t.shiftKey?u.transformStart(-f.row,-f.col):u.transformStart(f.row,f.col),t.preventDefault();break;case 36:t.ctrlKey||t.metaKey?s(h.view.getCellAtCoords({row:0,col:i.selStart.col})):s(h.view.getCellAtCoords({row:i.selStart.row,col:0}));break;case 35:t.ctrlKey||t.metaKey?s(h.view.getCellAtCoords({row:h.rowCount-1,col:i.selStart.col})):s(h.view.getCellAtCoords({row:i.selStart.row,col:h.colCount-1}));break;case 33:s(h.view.getCellAtCoords({row:0,col:i.selStart.col}));break;case 34:s(h.view.getCellAtCoords({row:h.rowCount-1,col:i.selStart.col}));break;default:}}}i.editProxy=e('<textarea class="handsontableInput">'),i.editProxyHolder=e('<div class="handsontableInputHolder">'),i.editProxyHolder.append(i.editProxy);var a=e(document.body);i.editProxy.on("click",t),i.editProxyHolder.on("cut",r),i.editProxyHolder.on("paste",s),i.editProxyHolder.on("keydown",f),h.container.append(i.editProxyHolder)},destroy:function(e){typeof i.editorDestroyer=="function"&&(i.editorDestroyer(e),i.editorDestroyer=null)},prepare:function(){i.editProxy.height(i.editProxy.parent().innerHeight()-4),i.editProxy.val(s.getText(i.selStart,i.selEnd)),setTimeout(a.focus,1),i.editorDestroyer=h.view.applyCellTypeMethod("editor",h.view.getCellAtCoords(i.selStart),i.selStart,i.editProxy)},focus:function(){i.editProxy[0].select()}},this.init=function(){this.view=new n.TableView(this),typeof r.cols!="undefined"&&(r.startCols=r.cols),h.colCount=r.startCols,h.rowCount=0,f.init(),i.currentBorder=new n.Border(h,{className:"current",bg:!0}),a.init(),v(),this.updateSettings(r),n.PluginHooks.run(h,"afterInit")},c=function(t,n){var r=e.Deferred(),s=[];if(n==="paste"){var o=function(n){var r=e.Deferred();s.push(r);var i=t[n][3],o=typeof i=="string"?i.toLowerCase():null;return function(e){var s=!1;for(var u=0,a=e.length;u<a;u++){if(i===e[u]){s=!0;break}if(o===e[u].toLowerCase()){t[n][3]=e[u],s=!0;break}}s||(t[n]=null),r.resolve()}};for(var u=t.length-1;u>=0;u--){var a=h.getCellMeta(t[u][0],t[u][1]);if(a.strict&&a.source){var f=e.isFunction(a.source)?a.source(t[u][3],o(u)):a.source;f&&o(u)(f)}}}return e.when(s).then(function(){for(var s=t.length-1;s>=0;s--)t[s]===null&&t.splice(s,1);if(i.settings.onBeforeChange&&t.length){var o=i.settings.onBeforeChange.apply(h.rootElement[0],[t,n]);typeof o=="function"?e.when(o).then(function(){r.resolve()}):(o===!1&&t.splice(0,t.length),r.resolve())}else r.resolve()}),e.when(r)};var v=function(){h.rootElement.on("datachange.handsontable",function(e,t,n){i.settings.onChange&&i.settings.onChange.apply(h.rootElement[0],[t,n])}),h.rootElement.on("selection.handsontable",function(e,t,n,r,s){i.settings.onSelection&&i.settings.onSelection.apply(h.rootElement[0],[t,n,r,s])}),h.rootElement.on("selectionbyprop.handsontable",function(e,t,n,r,s){i.settings.onSelectionByProp&&i.settings.onSelectionByProp.apply(h.rootElement[0],[t,n,r,s])})};this.setDataAtCell=function(t,n,r,a){var f=!1,l=!1,p,d,v,m=[];typeof t=="object"?p=t:e.isPlainObject(r)?p=r:p=[[t,n,r]];for(d=0,v=p.length;d<v;d++)p[d].splice(2,0,s.get(p[d][0],p[d][1]));c(p,a).then(function(){for(d=0,v=p.length;d<v;d++){t=p[d][0],n=p[d][1];var e=s.propToCol(n);r=p[d][3],m.push([p[d][0],e,p[d][2],p[d][3],p[d][4]]);if(i.settings.minSpareRows)while(t>h.rowCount-1)s.createRow(),h.view.createRow(),h.view.renderRow(h.rowCount-1),f=!0;if(i.dataType==="array"&&i.settings.minSpareCols)while(e>h.colCount-1)s.createCol(),h.view.createCol(),h.view.renderCol(h.colCount-1),l=!0;h.view.render(t,e,n,r),s.set(t,n,r)}f&&h.blockedCols.refresh(),l&&h.blockedRows.refresh();var c=o.keepEmptyRows();c||u.refreshBorders(),h.rootElement.triggerHandler("datachange.handsontable",[p,a||"edit"]),h.rootElement.triggerHandler("cellrender.handsontable",[p,a||"edit"])})},this.destroyEditor=function(e){u.refreshBorders(e)},this.populateFromArray=function(e,t,n,r){return o.populateFromArray(e,t,n,r)},this.getCornerCoords=function(e){return o.getCornerCoords(e)},this.getSelected=function(){if(u.isSelected()){var e=o.getCornerCoords([i.selStart,i.selEnd]);return[e.TL.row,e.TL.col,e.BR.row,e.BR.col]}},this.render=function(e,t){if(typeof e=="undefined"){e=[];var n,r,o,u,a=i.settings.columns&&i.settings.columns.length||i.settings.startCols;for(n=0;n<i.settings.startRows;n++)for(r=0;r<a;r++)o=s.colToProp(r),u=s.get(n,o),e.push([n,o,u,u])}for(var f=0,l=e.length;f<l;f++)h.view.render(e[f][0],s.propToCol(e[f][1]),e[f][1],e[f][3]);h.rootElement.triggerHandler("cellrender.handsontable",[e,t||"render"])},this.loadData=function(t){i.isPopulated=!1,i.settings.data=t,e.isPlainObject(i.settings.dataSchema)||e.isPlainObject(t[0])?i.dataType="object":i.dataType="array",t[0]?i.duckDataSchema=s.recursiveDuckSchema(t[0]):i.duckDataSchema={},s.createMap();var n=i.settings.data.length;while(i.settings.startRows>n)s.createRow(),n++;while(h.rowCount<n)h.view.createRow();o.keepEmptyRows(),o.clear();var r=[],u=i.settings.columns&&i.settings.columns.length||i.settings.startCols;for(var a=0;a<n;a++)for(var f=0;f<u;f++){var l=s.colToProp(f);r.push([a,l,"",s.get(a,l)])}h.rootElement.triggerHandler("datachange.handsontable",[r,"loadData"]),h.render(r,"loadData"),i.isPopulated=!0,h.clearUndo()},this.getData=function(e,t,n,r){return typeof e=="undefined"?s.getAll():s.getRange({row:e,col:t},{row:n,col:r})},this.updateSettings=function(t){var r,a,f;typeof t.rows!="undefined"&&(t.startRows=t.rows),typeof t.cols!="undefined"&&(t.startCols=t.cols),typeof t.fillHandle!="undefined"&&(l.handle&&t.fillHandle===!1?l.disable():!l.handle&&t.fillHandle!==!1&&l.init()),typeof t.undo!="undefined"&&(i.undoRedo&&t.undo===!1?i.undoRedo=null:!i.undoRedo&&t.undo===!0&&(i.undoRedo=new n.UndoRedo(h))),h.blockedCols||(h.blockedCols=new n.BlockedCols(h),h.blockedRows=new n.BlockedRows(h));for(r in t){if(r==="data")continue;t.hasOwnProperty(r)&&(i.settings[r]=t[r],n.extension[r]&&(i.extensions[r]=new n.extension[r](h,t[r])))}typeof t.colHeaders!="undefined"&&(t.colHeaders===!1&&i.extensions.ColHeader?i.extensions.ColHeader.destroy():t.colHeaders!==!1&&(i.extensions.ColHeader=new n.ColHeader(h,t.colHeaders))),typeof t.rowHeaders!="undefined"&&(t.rowHeaders===!1&&i.extensions.RowHeader?i.extensions.RowHeader.destroy():t.rowHeaders!==!1&&(i.extensions.RowHeader=new n.RowHeader(h,t.rowHeaders)));var c=h.blockedRows.count(),p=h.blockedCols.count();if(c&&p&&(typeof t.rowHeaders!="undefined"||typeof t.colHeaders!="undefined")){h.blockedCorner&&(h.blockedCorner.remove(),h.blockedCorner=null);var d=h.table.position();h.positionFix(d);var v=document.createElement("div");v.style.position="absolute",v.style.top=d.top+"px",v.style.left=d.left+"px";var m=document.createElement("table");m.cellPadding=0,m.cellSpacing=0,v.appendChild(m);var g=document.createElement("thead");m.appendChild(g);var y,b;for(r=0;r<c;r++){y=document.createElement("tr");for(a=p-1;a>=0;a--)b=document.createElement("th"),b.className=h.blockedCols.headers[a].className,b.innerHTML=h.blockedCols.headerText("&nbsp;"),h.minWidthFix(b),y.appendChild(b);g.appendChild(y)}h.blockedCorner=e(v),h.blockedCorner.on("click",function(){u.selectAll()}),h.container.append(h.blockedCorner)}else h.blockedCorner&&(h.blockedCorner.remove(),h.blockedCorner=null);typeof t.data!="undefined"?(h.loadData(t.data),f=!0):typeof t.columns!="undefined"&&s.createMap(),f||(f=o.keepEmptyRows()),f||u.refreshBorders(),h.blockedCols.update(),h.blockedRows.update()},this.getSettings=function(){return i.settings},this.clear=function(){u.selectAll(),u.empty()},this.isUndoAvailable=function(){return i.undoRedo&&i.undoRedo.isUndoAvailable()},this.isRedoAvailable=function(){return i.undoRedo&&i.undoRedo.isRedoAvailable()},this.undo=function(){i.undoRedo&&i.undoRedo.undo()},this.redo=function(){i.undoRedo&&i.undoRedo.redo()},this.clearUndo=function(){i.undoRedo&&i.undoRedo.clear()},this.alter=function(e,t,n){typeof n=="undefined"&&(n=t);switch(e){case"insert_row":case"remove_row":o.alter(e,{row:t,col:0},{row:n,col:0});break;case"insert_col":case"remove_col":o.alter(e,{row:0,col:t},{row:0,col:n});break;default:throw Error('There is no such action "'+e+'"')}},this.getCell=function(e,t){return h.view.getCellAtCoords({row:e,col:t})},this.colToProp=function(e){return s.colToProp(e)},this.propToCol=function(e){return s.propToCol(e)},this.getDataAtCell=function(e,t){return s.get(e,s.colToProp(t))},this.getCellMeta=function(t,r){var u={},a=s.colToProp(r);return i.settings.columns&&(u=e.extend(!0,u,i.settings.columns[r]||{})),i.settings.cells&&(u=e.extend(!0,u,i.settings.cells(t,r,a)||{})),u.isWritable=o.isCellWritable(e(h.view.getCellAtCoords({row:t,col:r})),u),n.PluginHooks.run(h,"afterGetCellMeta",[t,r,u]),u},this.setCellReadOnly=function(t,n){e(h.view.getCellAtCoords({row:t,col:n})).data("readOnly",!0)},this.setCellEditable=function(t,n){e(h.view.getCellAtCoords({row:t,col:n})).data("readOnly",!1)};var m=function(e,t,n){if(e){if(typeof n!="undefined")return e.columnLabel(n);var r=[];for(var i=0;i<t;i++)r.push(e.columnLabel(i));return r}};this.getRowHeader=function(e){return m(h.rowHeader,h.rowCount,e)},this.getColHeader=function(e){return m(h.colHeader,h.colCount,e)},this.countRows=function(){return i.settings.data.length},this.countCols=function(){return h.colCount},this.selectCell=function(e,t,n,r,i){if(typeof e!="number"||e<0||e>=h.rowCount)return!1;if(typeof t!="number"||t<0||t>=h.colCount)return!1;if(typeof n!="undefined"){if(typeof n!="number"||n<0||n>=h.rowCount)return!1;if(typeof r!="number"||r<0||r>=h.colCount)return!1}u.start({row:e,col:t}),typeof n=="undefined"?u.setRangeEnd(h.getCell(e,t),i):u.setRangeEnd(h.getCell(n,r),i)},this.selectCellByProp=function(e,t,n,r,i){return arguments[1]=s.propToCol(arguments[1]),typeof arguments[3]!="undefined"&&(arguments[3]=s.propToCol(arguments[3])),h.selectCell.apply(h,arguments)},this.deselectCell=function(){u.deselect()},this.destroy=function(){h.rootElement.empty(),h.rootElement.removeData("handsontable")},this.version="0.7.4-dev"};var r={data:[],startRows:5,startCols:5,minSpareRows:0,minSpareCols:0,minHeight:0,minWidth:0,multiSelect:!0,fillHandle:!0,undo:!0,outsideClickDeselects:!0,enterBeginsEditing:!0,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:!1,autoWrapCol:!1};e.fn.handsontable=function(t,i){var s,o,u,a=[];if(typeof t!="string")return i=t,this.each(function(){var t=e(this);if(t.data("handsontable"))u=t.data("handsontable"),u.updateSettings(i);else{var o=e.extend(!0,{},r),u;for(s in i)i.hasOwnProperty(s)&&(o[s]=i[s]);u=new n.Core(t,o),t.data("handsontable",u),u.init()}});u=[];if(arguments.length>1)for(s=1,o=arguments.length;s<o;s++)u.push(arguments[s]);return this.each(function(){a=e(this).data("handsontable")[t].apply(this,u)}),a},n.TableView=function(r){function l(){s.isMouseOverTable=!0}function c(){s.isMouseOverTable=!1}function p(){s.isMouseDown&&setTimeout(i.instance.editproxy.focus,1),s.isMouseDown=!1,i.instance.autofill.handle&&i.instance.autofill.handle.isDragged&&(i.instance.autofill.handle.isDragged>1&&i.instance.autofill.apply(),i.instance.autofill.handle.isDragged=0)}function d(t){i.instance.getSettings().outsideClickDeselects&&setTimeout(function(){!s.isMouseOverTable&&t.target!==s.tableContainer&&e(t.target).attr("id")!=="context-menu-layer"&&i.instance.selection.deselect()},1)}var i=this;this.instance=r;var s={},o={onMouseDown:function(e){s.isMouseDown=!0;if(e.button!==2||!i.instance.selection.inInSelection(i.getCellCoords(this)))e.shiftKey?i.instance.selection.setRangeEnd(this):i.instance.selection.setRangeStart(this)},onMouseOver:function(){s.isMouseDown?i.instance.selection.setRangeEnd(this):i.instance.autofill.handle&&i.instance.autofill.handle.isDragged&&(i.instance.autofill.handle.isDragged++,i.instance.autofill.showBorder(this))},onMouseWheel:function(e,t,n,r){s.virtualScroll&&(r?s.virtualScroll.scrollTop(s.virtualScroll.scrollTop()+44*-r):n&&s.virtualScroll.scrollLeft(s.virtualScroll.scrollLeft()+100*n),e.preventDefault())}};i.instance.container=e('<div class="handsontable"></div>');var u=i.instance.rootElement.css("overflow");if(u==="auto"||u==="scroll"){i.instance.container[0].style.overflow=u;var a=i.instance.rootElement.css("width");a&&(i.instance.container[0].style.width=a);var f=i.instance.rootElement.css("height");f&&(i.instance.container[0].style.height=f),i.instance.rootElement[0].style.overflow="hidden",i.instance.rootElement[0].style.position="relative"}i.instance.rootElement.append(i.instance.container),i.instance.curScrollTop=i.instance.curScrollLeft=0,i.instance.lastScrollTop=i.instance.lastScrollLeft=null,this.scrollbarSize=this.measureScrollbar();var h=e('<div><table class="htCore" cellspacing="0" cellpadding="0"><thead></thead><tbody></tbody></table></div>');s.tableContainer=h[0],i.instance.table=e(s.tableContainer.firstChild),this.$tableBody=i.instance.table.find("tbody")[0],i.instance.table.on("mousedown","td",o.onMouseDown),i.instance.table.on("mouseover","td",o.onMouseOver),i.instance.table.on("mousewheel","td",o.onMouseWheel),i.instance.container.append(h),i.instance.container.on("mouseenter",l).on("mouseleave",c),e("html").on("mouseup",p).on("click",d),i.instance.container[0].tagName.toLowerCase()!=="html"&&i.instance.container[0].tagName.toLowerCase()!=="body"&&(i.instance.container.css("overflow")==="scroll"||i.instance.container.css("overflow")==="auto")&&(i.scrollable=i.instance.container),i.scrollable?(s.virtualScroll=e('<div class="virtualScroll"><div class="spacer"></div></div>'),i.scrollable=s.virtualScroll,i.instance.container.before(s.virtualScroll),i.instance.table[0].style.position="absolute",s.virtualScroll.css({width:i.instance.container.width()+"px",height:i.instance.container.height()+"px",overflow:i.instance.container.css("overflow")}),i.instance.container.css({overflow:"hidden",position:"absolute",top:"0px",left:"0px"}),i.instance.container.width(s.virtualScroll.innerWidth()-this.scrollbarSize.width),i.instance.container.height(s.virtualScroll.innerHeight()-this.scrollbarSize.height),setInterval(function(){s.virtualScroll.find(".spacer").height(i.instance.table.height()),s.virtualScroll.find(".spacer").width(i.instance.table.width())},100),i.scrollable.scrollTop(0),i.scrollable.scrollLeft(0),i.scrollable.on("scroll.handsontable",function(){i.instance.curScrollTop=i.scrollable[0].scrollTop,i.instance.curScrollLeft=i.scrollable[0].scrollLeft,i.instance.curScrollTop!==i.instance.lastScrollTop&&(i.instance.blockedRows.refreshBorders(),i.instance.blockedCols.main[0].style.top=-i.instance.curScrollTop+"px",i.instance.table[0].style.top=-i.instance.curScrollTop+"px"),i.instance.curScrollLeft!==i.instance.lastScrollLeft&&(i.instance.blockedCols.refreshBorders(),i.instance.blockedRows.main[0].style.left=-i.instance.curScrollLeft+"px",i.instance.table[0].style.left=-i.instance.curScrollLeft+"px");if(i.instance.curScrollTop!==i.instance.lastScrollTop||i.instance.curScrollLeft!==i.instance.lastScrollLeft)i.instance.selection.refreshBorders(),i.instance.blockedCorner&&(i.instance.curScrollTop===0&&i.instance.curScrollLeft===0?(i.instance.blockedCorner.find("th:last-child").css({borderRightWidth:0}),i.instance.blockedCorner.find("tr:last-child th").css({borderBottomWidth:0})):i.instance.lastScrollTop===0&&i.instance.lastScrollLeft===0&&(i.instance.blockedCorner.find("th:last-child").css({borderRightWidth:"1px"}),i.instance.blockedCorner.find("tr:last-child th").css({borderBottomWidth:"1px"})));i.instance.lastScrollTop=i.instance.curScrollTop,i.instance.lastScrollLeft=i.instance.curScrollLeft,i.instance.selection.refreshBorders()}),n.PluginHooks.push("afterInit",function(){i.scrollable.trigger("scroll.handsontable")})):(i.scrollable=e(t),i.instance.blockedCorner&&(i.instance.blockedCorner.find("th:last-child").css({borderRightWidth:0}),i.instance.blockedCorner.find("tr:last-child th").css({borderBottomWidth:0}))),i.scrollable.on("scroll",function(e){e.stopPropagation()}),e(t).on("resize",function(){i.instance.blockedCols.update(),i.instance.blockedRows.update()}),e(".context-menu-root").on("mouseenter",l).on("mouseleave",c)},n.TableView.prototype.measureScrollbar=function(){var t=e('<div style="width:150px;height:150px;overflow:hidden;position:absolute;top:200px;left:200px"><div style="width:100%;height:100%;position:absolute">x</div>');e("body").append(t);var n=e(t[0].firstChild),r=n.innerWidth(),i=n.innerHeight();return t[0].style.overflow="scroll",r-=n.innerWidth(),i-=n.innerHeight(),r===0&&(r=17),i===0&&(i=17),t.remove(),{width:r,height:i}},n.TableView.prototype.createRow=function(e){var t,n,r,i;t=document.createElement("tr"),this.instance.blockedCols.createRow(t);for(n=0;n<this.instance.colCount;n++)t.appendChild(i=document.createElement("td")),this.instance.minWidthFix(i);if(!e||e.row>=this.instance.rowCount)this.$tableBody.appendChild(t);else{var s=this.instance.getCell(e.row,e.col).parentNode;this.$tableBody.insertBefore(t,s)}this.instance.rowCount++},n.TableView.prototype.createCol=function(e){var t=this.$tableBody.childNodes,n,r,i;this.instance.blockedRows.createCol();if(!e||e.col>=this.instance.colCount)for(n=0;n<this.instance.rowCount;n++)t[n].appendChild(i=document.createElement("td")),this.instance.minWidthFix(i);else for(n=0;n<this.instance.rowCount;n++)t[n].insertBefore(i=document.createElement("td"),this.instance.getCell(n,e.col)),this.instance.minWidthFix(i);this.instance.colCount++},n.TableView.prototype.removeRow=function(t,n){if(!t||t.row===this.instance.rowCount-1)e(this.$tableBody.childNodes[this.instance.rowCount-1]).remove(),this.instance.rowCount--;else for(var r=n.row;r>=t.row;r--)e(this.$tableBody.childNodes[r]).remove(),this.instance.rowCount--},n.TableView.prototype.removeCol=function(t,n){var r=this.$tableBody.childNodes,i,s;this.instance.blockedRows&&(i=this.instance.table.find("thead th"));var o=0;if(!t||t.col===this.instance.colCount-1){for(;o<this.instance.rowCount;o++)e(r[o].childNodes[this.instance.colCount+this.instance.blockedCols.count()-1]).remove(),i&&i.eq(this.instance.colCount+this.instance.blockedCols.count()-1).remove();this.instance.colCount--}else{for(;o<this.instance.rowCount;o++)for(s=n.col;s>=t.col;s--)e(r[o].childNodes[s+this.instance.blockedCols.count()]).remove();if(i)for(s=n.col;s>=t.col;s--)i.eq(s+this.instance.blockedCols.count()).remove();this.instance.colCount-=n.col-t.col+1}},n.TableView.prototype.render=function(e,t,n,r){var i={row:e,col:t},s=this.instance.getCell(e,t);return this.applyCellTypeMethod("renderer",s,i,r),this.instance.minWidthFix(s),s},n.TableView.prototype.renderRow=function(e){var t,n;for(t=0;t<this.instance.colCount;t++)n=this.instance.colToProp(t),this.render(e,t,n,this.instance.getData()[e][n])},n.TableView.prototype.renderCol=function(e){var t,n;for(t=0;t<this.instance.rowCount;t++)n=this.instance.colToProp(e),this.render(t,e,n,this.instance.getData()[t][n])},n.TableView.prototype.applyCellTypeMethod=function(e,t,r,i){var s=this.instance.colToProp(r.col),o,u=this.instance.getCellMeta(r.row,r.col);return u.type&&typeof u.type[e]=="function"&&(o=u.type[e]),typeof o!="function"&&(o=n.TextCell[e]),o(this.instance,t,r.row,r.col,s,i,u)},n.TableView.prototype.getCellCoords=function(e){return{row:e.parentNode.rowIndex-this.instance.blockedRows.count(),col:e.cellIndex-this.instance.blockedCols.count()}},n.TableView.prototype.getCellAtCoords=function(e){if(e.row<0||e.col<0)return null;var t=this.$tableBody.childNodes[e.row];return t?t.childNodes[e.col+this.instance.blockedCols.count()]:null},n.TableView.prototype.getAllCells=function(){var e=[],t,n,r,i,s;t=this.$tableBody.childNodes,r=this.instance.rowCount;if(r>0){s=this.instance.colCount;for(n=0;n<r;n++)for(i=0;i<s;i++)e.push(t[n].childNodes[i+this.instance.blockedCols.count()])}return e},n.TableView.prototype.scrollViewport=function(t){if(!this.instance.selection.isSelected())return!1;var n=e(t),r=n.offset(),i=this.scrollable.scrollLeft(),s=this.scrollable.scrollTop(),o=this.scrollable.offset(),u=this.instance.blockedCols.count()?e(this.instance.blockedCols.main[0].firstChild).outerWidth():2,a=this.instance.blockedRows.count()?e(this.instance.blockedRows.main[0].firstChild).outerHeight():2,f=r.top,l=r.left,c,h;o?(c=this.scrollable.outerWidth(),h=this.scrollable.outerHeight(),f+=s-o.top,l+=i-o.left):(c=this.scrollable.width(),h=this.scrollable.height()),c-=this.scrollbarSize.width,h-=this.scrollbarSize.height;var p=n.outerHeight(),d=n.outerWidth(),v=this;i+c<=l+d?setTimeout(function(){v.scrollable.scrollLeft(l+d-c)},1):i>l-u&&setTimeout(function(){v.scrollable.scrollLeft(l-u)},1),s+h<=f+p?setTimeout(function(){v.scrollable.scrollTop(f+p-h)},1):s>f-a&&setTimeout(function(){v.scrollable.scrollTop(f-a)},1)},n.helper.isPrintableChar=function(e){return e==32||e>=48&&e<=57||e>=96&&e<=111||e>=186&&e<=192||e>=219&&e<=222||e>=226||e>=65&&e<=90},n.helper.stringify=function(e){switch(typeof e){case"string":case"number":return e+"";case"object":return e===null?"":e.toString();case"undefined":return"";default:return e.toString()}},n.Border=function(t,n){this.instance=t,this.$container=t.container;var r=this.$container[0];n.bg&&(this.bg=document.createElement("div"),this.bg.className="htBorderBg "+n.className,r.insertBefore(this.bg,r.firstChild)),this.main=document.createElement("div"),this.main.style.position="absolute",this.main.style.top=0,this.main.style.left=0,this.main.innerHTML=(new Array(5)).join('<div class="htBorder '+n.className+'"></div>'),this.disappear(),r.appendChild(this.main);var i=this.main.childNodes;this.top=i[0],this.left=i[1],this.bottom=i[2],this.right=i[3],this.borderWidth=e(this.left).width()},n.Border.prototype={appear:function(t){var n,r,i,s,o,u,a,f,l,c,h;if(this.disabled)return;this.corners=this.instance.getCornerCoords(t),n=e(this.instance.getCell(this.corners.TL.row,this.corners.TL.col)),r=t.length>1?e(this.instance.getCell(this.corners.BR.row,this.corners.BR.col)):n,i=n.offset(),s=t.length>1?r.offset():i,o=this.$container.offset(),a=i.top,c=s.top+r.outerHeight()-a,l=i.left,h=s.left+r.outerWidth()-l,u=a-o.top+this.$container.scrollTop()-1,f=l-o.left+this.$container.scrollLeft()-1,parseInt(n.css("border-top-width"))>0&&(u+=1,c-=1),parseInt(n.css("border-left-width"))>0&&(f+=1,h-=1),this.bg&&(this.bg.style.top=u+"px",this.bg.style.left=f+"px",this.bg.style.width=h+"px",this.bg.style.height=c+"px",this.bg.style.display="block"),this.top.style.top=u+"px",this.top.style.left=f+"px",this.top.style.width=h+"px",this.left.style.top=u+"px",this.left.style.left=f+"px",this.left.style.height=c+"px";var p=Math.floor(this.borderWidth/2);this.bottom.style.top=u+c-p+"px",this.bottom.style.left=f+"px",this.bottom.style.width=h+"px",this.right.style.top=u+"px",this.right.style.left=f+h-p+"px",this.right.style.height=c+1+"px",this.main.style.display="block"},disappear:function(){this.main.style.display="none",this.bg&&(this.bg.style.display="none"),this.corners=null}},n.FillHandle=function(t){this.instance=t,this.$container=t.container;var n=this.$container[0];this.handle=document.createElement("div"),this.handle.className="htFillHandle",this.disappear(),n.appendChild(this.handle);var r=this;e(this.handle).mousedown(function(){r.isDragged=1}),this.$container.find("table").on("selectstart",function(e){e.preventDefault()})},n.FillHandle.prototype={appear:function(t){if(this.disabled)return;var n,r,i,s,o,u,a,f=this.instance.getCornerCoords(t);n=e(this.instance.getCell(f.BR.row,f.BR.col)),r=n.offset(),i=this.$container.offset(),s=r.top-i.top+this.$container.scrollTop()-1,o=r.left-i.left+this.$container.scrollLeft()-1,u=n.outerHeight(),a=n.outerWidth(),this.handle.style.top=s+u-3+"px",this.handle.style.left=o+a-3+"px",this.handle.style.display="block"},disappear:function(){this.handle.style.display="none"}},n.UndoRedo=function(e){var t=this;this.instance=e,this.clear(),e.rootElement.on("datachange.handsontable",function(e,n,r){r!=="undo"&&r!=="redo"&&t.add(n)})},n.UndoRedo.prototype.undo=function(){var t,n;if(this.isUndoAvailable()){var r=e.extend(!0,[],this.data[this.rev]);for(t=0,n=r.length;t<n;t++)r[t].splice(3,1);this.instance.setDataAtCell(r,null,null,"undo"),this.rev--}},n.UndoRedo.prototype.redo=function(){var t,n;if(this.isRedoAvailable()){this.rev++;var r=e.extend(!0,[],this.data[this.rev]);for(t=0,n=r.length;t<n;t++)r[t].splice(2,1);this.instance.setDataAtCell(r,null,null,"redo")}},n.UndoRedo.prototype.isUndoAvailable=function(){return this.rev>=0},n.UndoRedo.prototype.isRedoAvailable=function(){return this.rev<this.data.length-1},n.UndoRedo.prototype.add=function(e){this.rev++,this.data.splice(this.rev),this.data.push(e)},n.UndoRedo.prototype.clear=function(){this.data=[],this.rev=-1},n.BlockedRows=function(t){var n=this;this.instance=t,this.headers=[];var r=t.table.position();t.positionFix(r),this.main=e('<div style="position: absolute; top: '+r.top+"px; left: "+r.left+'px"><table class="htBlockedRows" cellspacing="0" cellpadding="0"><thead></thead></table></div>'),this.instance.container.append(this.main),this.hasCSS3=!(e.browser.msie&&parseInt(e.browser.version,10)<=8),this.update(),this.instance.rootElement.on("cellrender.handsontable",function(e,t,r){setTimeout(function(){n.dimensions()},10)})},n.BlockedRows.prototype.count=function(){return this.headers.length},n.BlockedRows.prototype.createCol=function(t){var n,r,i,s=this.count();for(i=0;i<s;i++)n=this.main.find("thead tr."+this.headers[i].className),n.length||(n=e('<tr class="'+this.headers[i].className+'"></tr>'),this.main.find("thead").append(n)),n=this.instance.table.find("thead tr."+this.headers[i].className),n.length||(n=e('<tr class="'+this.headers[i].className+'"></tr>'),this.instance.table.find("thead").append(n)),r=document.createElement("th"),r.className=this.headers[i].className,t&&(r.className+=" "+t),r.innerHTML=this.headerText("&nbsp;"),this.instance.minWidthFix(r),this.instance.table.find("thead tr."+this.headers[i].className)[0].appendChild(r),r=document.createElement("th"),r.className=this.headers[i].className,t&&(r.className+=" "+t),this.instance.minWidthFix(r),this.main.find("thead tr."+this.headers[i].className)[0].appendChild(r)},n.BlockedRows.prototype.create=function(){var e;if(this.count()>0){this.instance.table.find("thead").empty(),this.main.find("thead").empty();var t=this.instance.blockedCols.count();for(e=t-1;e>=0;e--)this.createCol(this.instance.blockedCols.headers[e].className);for(e=0;e<this.instance.colCount;e++)this.createCol()}this.hasCSS3||(this.instance.container.find("thead tr.lastChild").not(":last-child").removeClass("lastChild"),this.instance.container.find("thead tr:last-child").not(".lastChild").addClass("lastChild"))},n.BlockedRows.prototype.refresh=function(){var t;if(this.count()>0){var n=this,r=this.count(),i;for(i=0;i<r;i++){var s=this.main.find("thead tr."+this.headers[i].className),o=s[0],u=o.childNodes,a=u.length,f=this.instance.blockedCols.count();while(a>this.instance.colCount+f)a--,e(o.childNodes[a]).remove();for(i=0;i<r;i++){var l=this.instance.table.find("thead th."+this.headers[i].className);for(var c=0;c<a;c++)t=n.headers[i].columnLabel(c-f),this.headers[i].format&&this.headers[i].format==="small"?(l[c].innerHTML=this.headerText(t),u[c].innerHTML=this.headerText(t)):(l[c].innerHTML=t,u[c].innerHTML=t),this.instance.minWidthFix(l[c]),this.instance.minWidthFix(u[c]),u[c].style.minWidth=l.eq(c).width()+"px"}}this.ths=this.main.find("tr:last-child th"),this.refreshBorders()}},n.BlockedRows.prototype.refreshBorders=function(){this.count()>0&&(this.instance.curScrollTop===0?this.ths.css("borderBottomWidth",0):this.instance.lastScrollTop===0&&this.ths.css("borderBottomWidth","1px"))},n.BlockedRows.prototype.dimensions=function(){if(this.count()>0){var t=this.instance.table.find("thead th");for(var n=0,r=t.length;n<r;n++)this.ths[n].style.minWidth=e(t[n]).width()+"px"}},n.BlockedRows.prototype.update=function(){this.create(),this.refresh()},n.BlockedRows.prototype.addHeader=function(e){for(var t=this.count()-1;t>=0;t--)this.headers[t].className===e.className&&this.headers.splice(t,1);this.headers.push(e),this.headers.sort(function(e,t){return e.priority||0-t.priority||0}),this.update()},n.BlockedRows.prototype.destroyHeader=function(e){for(var t=this.count()-1;t>=0;t--)this.headers[t].className===e&&(this.main.find("thead tr."+this.headers[t].className).remove(),this.instance.table.find("thead tr."+this.headers[t].className).remove(),this.headers.splice(t,1))},n.BlockedRows.prototype.headerText=function(e){return'&nbsp;<span class="small">'+e+"</span>&nbsp;"},n.BlockedCols=function(t){var n=this;this.instance=t,this.headers=[];var r=t.table.position();t.positionFix(r),this.main=e('<div style="position: absolute; top: '+r.top+"px; left: "+r.left+'px"><table class="htBlockedCols" cellspacing="0" cellpadding="0"><thead><tr></tr></thead><tbody></tbody></table></div>'),this.instance.container.append(this.main),this.heightMethod=this.determineCellHeightMethod(),this.instance.rootElement.on("cellrender.handsontable",function(){setTimeout(function(){n.dimensions()},10)})},n.BlockedCols.prototype.determineCellHeightMethod=function(){return"height"},n.BlockedCols.prototype.count=function(){return this.headers.length},n.BlockedCols.prototype.createRow=function(e){var t,n=document.createElement("tr");for(var r=0,i=this.count();r<i;r++)t=document.createElement("th"),t.className=this.headers[r].className,this.instance.minWidthFix(t),e.insertBefore(t,e.firstChild),t=document.createElement("th"),t.className=this.headers[r].className,n.insertBefore(t,n.firstChild);this.main.find("tbody")[0].appendChild(n)},n.BlockedCols.prototype.create=function(){var e=this.count(),t,n;this.main.find("tbody").empty(),this.instance.table.find("tbody th").remove();var r=this.main.find("thead tr");r.empty();if(e>0){var i=this.instance.blockedRows.count();if(i)for(t=0;t<e;t++)n=r[0].getElementsByClassName?r[0].getElementsByClassName(this.headers[t].className)[0]:r.find("."+this.headers[t].className.replace(/\s/i,"."))[0],n||(n=document.createElement("th"),n.className=this.headers[t].className,n.innerHTML=this.headerText("&nbsp;"),this.instance.minWidthFix(n),r[0].insertBefore(n,r[0].firstChild));var s=this.instance.table.find("tbody")[0].childNodes;for(var o=0;o<this.instance.rowCount;o++)this.createRow(s[o])}},n.BlockedCols.prototype.refresh=function(){var t=this.count(),n,r,i,s,o;if(t>0){var u=this.main.find("tbody"),a=u[0],f=a.childNodes,l=f.length;while(l>this.instance.rowCount)l--,e(a.childNodes[l]).remove();var c=this.instance.table.find("tbody tr");for(s=0;s<l;s++)for(n=0;n<t;n++)o=this.headers[n].columnLabel(s),i=c[s].getElementsByClassName?c[s].getElementsByClassName(this.headers[n].className)[0]:e(c[s]).find("."+this.headers[n].className.replace(/\s/i,"."))[0],r=f[s].getElementsByClassName?f[s].getElementsByClassName(this.headers[n].className)[0]:e(f[s]).find("."+this.headers[n].className.replace(/\s/i,"."))[0],this.headers[n].format&&this.headers[n].format==="small"?(i.innerHTML=this.headerText(o),r.innerHTML=this.headerText(o)):(i.innerHTML=o,r.innerHTML=o),this.instance.minWidthFix(r),r.style.height=e(i)[this.heightMethod]()+"px";this.ths=this.main.find("th:last-child"),this.refreshBorders()}},n.BlockedCols.prototype.refreshBorders=function(){this.count()>0&&(this.instance.curScrollLeft===0?this.ths.css("borderRightWidth",0):this.instance.lastScrollLeft===0&&this.ths.css("borderRightWidth","1px"))},n.BlockedCols.prototype.dimensions=function(){if(this.count()>0){var t=this.instance.table[0].getElementsByTagName("tbody")[0].childNodes,n=this.main[0].firstChild.getElementsByTagName("tbody")[0].childNodes;for(var r=0,i=t.length;r<i;r++)n[r].firstChild.style.height=e(t[r].firstChild)[this.heightMethod]()+"px"}},n.BlockedCols.prototype.update=n.BlockedRows.prototype.update,n.BlockedCols.prototype.addHeader=function(e){for(var t=this.count()-1;t>=0;t--)this.headers[t].className===e.className&&this.headers.splice(t,1);this.headers.push(e),this.headers.sort(function(e,t){return e.priority||0-t.priority||0})},n.BlockedCols.prototype.destroyHeader=function(e){for(var t=this.count()-1;t>=0;t--)this.headers[t].className===e&&this.headers.splice(t,1)},n.BlockedCols.prototype.headerText=n.BlockedRows.prototype.headerText,n.RowHeader=function(t,n){var r=this;this.className="htRowHeader",t.blockedCols.main.on("mousedown","th.htRowHeader",function(n){if(!e(n.target).hasClass("btn")&&!e(n.target).hasClass("btnContainer")){t.deselectCell(),e(this).addClass("active"),r.lastActive=this;var i=t.blockedRows.count();t.selectCell(this.parentNode.rowIndex-i,0,this.parentNode.rowIndex-i,t.colCount-1,!1)}}),t.rootElement.on("deselect.handsontable",function(){r.deselect()}),this.labels=n,this.instance=t,this.instance.rowHeader=this,this.format="small",t.blockedCols.addHeader(this)},n.RowHeader.prototype.columnLabel=function(e){return typeof this.labels[e]!="undefined"?this.labels[e]:e+1},n.RowHeader.prototype.deselect=function(){this.lastActive&&(e(this.lastActive).removeClass("active"),this.lastActive=null)},n.RowHeader.prototype.destroy=function(){this.instance.blockedCols.destroyHeader(this.className)},n.ColHeader=function(t,n){var r=this;this.className="htColHeader",t.blockedRows.main.on("mousedown","th.htColHeader",function(){t.deselectCell();var n=e(this);n.addClass("active"),r.lastActive=this;var i=n.index(),s=t.blockedCols?t.blockedCols.count():0;t.selectCell(0,i-s,t.countRows()-1,i-s,!1)}),t.rootElement.on("deselect.handsontable",function(){r.deselect()}),this.instance=t,this.labels=n,this.instance.colHeader=this,this.format="small",t.blockedRows.addHeader(this)},n.ColHeader.prototype.columnLabel=function(e){if(typeof this.labels[e]!="undefined")return this.labels[e];var t=e+1,n="",r;while(t>0)r=(t-1)%26,n=String.fromCharCode(65+r)+n,t=parseInt((t-r)/26);return n},n.ColHeader.prototype.deselect=n.RowHeader.prototype.deselect,n.ColHeader.prototype.destroy=function(){this.instance.blockedRows.destroyHeader(this.className)},n.TextRenderer=function(e,t,r,i,s,o,u){var a=n.helper.stringify(o);a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),t.innerHTML=a.replace(/\n/g,"<br/>")},n.AutocompleteRenderer=function(t,r,i,s,o,u,a){var f=e(r),l=e('<div class="htAutocomplete"></div>'),c=e('<div class="htAutocompleteArrow">&#x25BC;</div>');c.mouseup(function(){f.triggerHandler("dblclick.editor")}),n.TextCell.renderer(t,l[0],i,s,o,u,a),l.html()===""&&l.html("&nbsp;"),l.append(c),f.empty().append(l)},n.CheckboxRenderer=function(t,r,i,s,o,u,a){return typeof a.checkedTemplate=="undefined"&&(a.checkedTemplate=!0),typeof a.uncheckedTemplate=="undefined"&&(a.uncheckedTemplate=!1),u===a.checkedTemplate||u===n.helper.stringify(a.checkedTemplate)?r.innerHTML="<input type='checkbox' checked autocomplete='no'>":u===a.uncheckedTemplate||u===n.helper.stringify(a.uncheckedTemplate)?r.innerHTML="<input type='checkbox' autocomplete='no'>":u===null?r.innerHTML="<input type='checkbox' autocomplete='no' style='opacity: 0.5'>":r.innerHTML="#bad value#",e(r).find("input").change(function(){e(this).is(":checked")?t.setDataAtCell(i,o,a.checkedTemplate):t.setDataAtCell(i,o,a.uncheckedTemplate)}),r};var i={isCellEdited:!1,getCaretPosition:function(e){var t=e[0];if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var n=document.selection.createRange();if(n==null)return 0;var r=t.createTextRange(),i=r.duplicate();return r.moveToBookmark(n.getBookmark()),i.setEndPoint("EndToStart",r),i.text.length}return 0},setCaretPosition:function(e,t){var n=e[0];if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var r=n.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",t),r.select()}},beginEditing:function(t,r,s,o,u,a,f,l){if(i.isCellEdited)return;a.on("cut.editor",function(e){e.stopPropagation()}),a.on("paste.editor",function(e){e.stopPropagation()});var c=e(r);if(!t.getCellMeta(s,o).isWritable)return;i.isCellEdited=!0;if(f){var h=t.getDataAtCell(s,u);h=n.helper.stringify(h)+(l||""),a.val(h),i.setCaretPosition(a,h.length)}else a.val("");var p=c.width(),d=c.outerHeight()-4;parseInt(c.css("border-top-width"))>0&&(d-=1),parseInt(c.css("border-left-width"))>0&&t.blockedCols.count()>0&&(p-=1),a.autoResize({maxHeight:200,minHeight:d,minWidth:p,maxWidth:Math.max(168,p),animate:!1,extraSpace:0}),a.parent().removeClass("htHidden"),t.rootElement.triggerHandler("beginediting.handsontable"),setTimeout(function(){a.parent().css({overflow:"visible"})},1)},finishEditing:function(t,n,r,s,o,u,a,f){if(i.triggerOnlyByDestroyer)return;if(i.isCellEdited){i.isCellEdited=!1;var l;a?l=[[i.originalValue]]:l=[[e.trim(u.val())]];if(f){var c=t.handsontable("getSelected");t.populateFromArray({row:c[0],col:c[1]},l,{row:c[2],col:c[3]},!1,"edit")}else t.populateFromArray({row:r,col:s},l,null,!1,"edit")}u.off(".editor"),e(n).off(".editor"),u.css({width:0,height:0}),u.parent().addClass("htHidden").css({overflow:"hidden"}),t.container.find(".htBorder.current").off(".editor"),t.rootElement.triggerHandler("finishediting.handsontable")}};n.TextEditor=function(t,r,s,o,u,a,f){function g(){a[0].focus(),i.beginEditing(t,r,s,o,u,a,!0)}i.isCellEdited=!1,i.originalValue=t.getDataAtCell(s,u),i.triggerOnlyByDestroyer=f.strict;var l=e(r),c=l.offset(),h=t.container.offset(),p=t.container.scrollTop(),d=t.container.scrollLeft(),v=c.top-h.top+p-1,m=c.left-h.left+d-1;return v<0&&(v=0),m<0&&(m=0),t.blockedRows.count()>0&&parseInt(l.css("border-top-width"))>0&&(v+=1),t.blockedCols.count()>0&&parseInt(l.css("border-left-width"))>0&&(m+=1),e.browser.msie&&parseInt(e.browser.version,10)<=7&&(v-=1),a.parent().addClass("htHidden").css({top:v,left:m,overflow:"hidden"}),a.css({width:0,height:0}),a.on("keydown.editor",function(f){var l=(f.ctrlKey||f.metaKey)&&!f.altKey;if(n.helper.isPrintableChar(f.keyCode)){!i.isCellEdited&&!l?(i.beginEditing(t,r,s,o,u,a),f.stopImmediatePropagation()):l&&(i.isCellEdited&&f.keyCode===65?f.stopPropagation():i.isCellEdited&&f.keyCode===88&&e.browser.opera?f.stopPropagation():i.isCellEdited&&f.keyCode===86&&e.browser.opera&&f.stopPropagation());return}switch(f.keyCode){case 38:i.isCellEdited&&i.finishEditing(t,r,s,o,u,a,!1);break;case 9:i.isCellEdited&&i.finishEditing(t,r,s,o,u,a,!1),f.preventDefault();break;case 39:i.isCellEdited&&(i.getCaretPosition(a)===a.val().length?i.finishEditing(t,r,s,o,u,a,!1):f.stopPropagation());break;case 37:i.isCellEdited&&(i.getCaretPosition(a)===0?i.finishEditing(t,r,s,o,u,a,!1):f.stopPropagation());break;case 8:case 46:i.isCellEdited&&f.stopPropagation();break;case 40:i.isCellEdited&&i.finishEditing(t,r,s,o,u,a,!1);break;case 27:i.isCellEdited&&(t.destroyEditor(!0),f.stopPropagation());break;case 113:i.isCellEdited||(i.beginEditing(t,r,s,o,u,a,!0),f.stopPropagation(),f.preventDefault());break;case 13:if(i.isCellEdited){var c=t.getSelected(),h=c[0]!==c[2]||c[1]!==c[3];f.ctrlKey&&!h||f.altKey?(a.val(a.val()+"\n"),a[0].focus(),f.stopPropagation()):i.finishEditing(t,r,s,o,u,a,!1,l)}else t.getSettings().enterBeginsEditing&&(l&&!selection.isMultiple()||f.altKey?i.beginEditing(t,r,s,o,u,a,!0,"\n"):i.beginEditing(t,r,s,o,u,a,!0),f.stopPropagation());f.preventDefault();break;case 36:f.stopPropagation();break;case 35:f.stopPropagation()}}),l.on("dblclick.editor",g),t.container.find(".htBorder.current").on("dblclick.editor",g),function(e){i.triggerOnlyByDestroyer=!1,i.finishEditing(t,r,s,o,u,a,e)}},n.AutocompleteEditor=function(t,r,i,o,u,a,f){function v(){c=!0,setTimeout(function(){a.data("typeahead").lookup()},1)}var l=a.data("typeahead"),c=!1;l?(l.$menu.off(),a.off(),l.listen()):(a.typeahead(),l=a.data("typeahead"),l._show=l.show,l._hide=l.hide,l._render=l.render,l._highlighter=l.highlighter),l.minLength=0,l.highlighter=l._highlighter,l.show=function(){if(a.parent().hasClass("htHidden"))return;return l._show.call(this)},l.hide=function(){if(!c)return c=!1,l._hide.call(this)},l.lookup=function(){var t;return this.query=this.$element.val(),t=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,t?this.process(t):this},l.matcher=function(){return!0},l.select=function(){var e=this.$menu.find(".active").attr("data-value")||a.val();return m(!0),t.setDataAtCell(i,u,l.updater(e)),this.hide()},l.render=function(e){return l._render.call(this,e),f.strict||this.$menu.find("li:eq(0)").removeClass("active"),this};for(var h in f)(l.hasOwnProperty(h)||h==="render")&&h!=="options"&&(l[h]=f[h]);var p=!1;a.on("keydown.editor",function(e){switch(e.keyCode){case 27:c=!1;break;case 37:case 39:case 38:case 40:case 9:case 13:a.parent().hasClass("htHidden")||e.stopImmediatePropagation(),e.preventDefault()}}),a.on("keyup.editor",function(t){if(p)return;switch(t.keyCode){case 9:case 13:if(!s(a)){var r=e.Event("keyup");r.keyCode=113,a.trigger(r)}else setTimeout(function(){var n=e.Event("keydown");n.keyCode=t.keyCode,a.parent().trigger(n)},10);break;default:n.helper.isPrintableChar(t.keyCode)||t.stopImmediatePropagation()}});var d=n.TextEditor(t,r,i,o,u,a,f);e(r).on("dblclick.editor",v),t.container.find(".htBorder.current").on("dblclick.editor",v);var m=function(e){p=!0,a.off(),d(e),c=!1,s(a)&&s(a).hide()};return m},n.CheckboxEditor=function(t,r,i,s,u,a,f){function l(){o(t,i,u,f)}typeof f=="undefined"&&(f={}),typeof f.checkedTemplate=="undefined"&&(f.checkedTemplate=!0),typeof f.uncheckedTemplate=="undefined"&&(f.uncheckedTemplate=!1),a.on("keydown.editor",function(e){var r=(e.ctrlKey||e.metaKey)&&!e.altKey;!r&&n.helper.isPrintableChar(e.keyCode)&&(o(t,i,u,f),e.stopPropagation())});var c=e(r);return c.on("dblclick.editor",l),t.container.find(".htBorder.current").on("dblclick.editor",l),function(){a.off(".editor"),c.off(".editor"),t.container.find(".htBorder.current").off(".editor")}},n.AutocompleteCell={renderer:n.AutocompleteRenderer,editor:n.AutocompleteEditor},n.CheckboxCell={renderer:n.CheckboxRenderer,editor:n.CheckboxEditor},n.TextCell={renderer:n.TextRenderer,editor:n.TextEditor},n.PluginHooks={hooks:{afterInit:[],afterGetCellMeta:[]},push:function(e,t){this.hooks[e].push(t)},unshift:function(e,t){this.hooks[e].unshift(t)},run:function(e,t,n){for(var r=0,i=this.hooks[t].length;r<i;r++)n?this.hooks[t][r].apply(e,n):this.hooks[t][r].call(e)}},n.PluginHooks.push("afterInit",u),n.PluginHooks.push("afterGetCellMeta",function(e,t,r){var i=this.getSettings(),s=this.getData(),o,u,a;if(i.autoComplete)for(o=0,u=i.autoComplete.length;o<u;o++)if(i.autoComplete[o].match(e,t,s)){typeof r.type=="undefined"?r.type=n.AutocompleteCell:(typeof r.type.renderer=="undefined"&&(r.type.renderer=n.AutocompleteCell.renderer),typeof r.type.editor=="undefined"&&(r.type.editor=n.AutocompleteCell.editor));for(a in i.autoComplete[o])i.autoComplete[o].hasOwnProperty(a)&&a!=="match"&&typeof r[o]=="undefined"&&(a==="source"?r[a]=i.autoComplete[o][a](e,t):r[a]=i.autoComplete[o][a]);break}}),function(e){function t(r){return this.filter(t.resizableFilterSelector).each(function(){new n(e(this),r)}),this}function n(n,r){if(this.clones)return;this.config=e.extend({},t.defaults,r),this.el=n,this.nodeName=n[0].nodeName.toLowerCase(),this.previousScrollTop=null,r.maxWidth==="original"&&(r.maxWidth=n.width()),r.minWidth==="original"&&(r.minWidth=n.width()),r.maxHeight==="original"&&(r.maxHeight=n.height()),r.minHeight==="original"&&(r.minHeight=n.height()),this.nodeName==="textarea"&&n.css({resize:"none",overflowY:"hidden"}),n.data("AutoResizer",this),this.createClone(),this.injectClone(),this.bind()}t.defaults={onResize:function(){},animate:{duration:200,complete:function(){}},extraSpace:50,minHeight:"original",maxHeight:500,minWidth:"original",maxWidth:500},t.cloneCSSProperties=["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","padding"],t.cloneCSSValues={position:"absolute",top:-9999,left:-9999,opacity:0,overflow:"hidden",border:"1px solid black",padding:"0.49em"},t.resizableFilterSelector="textarea,input:not(input[type]),input[type=text],input[type=password]",t.AutoResizer=n,e.fn.autoResize=t,n.prototype={bind:function(){var t=e.proxy(function(){return this.check(),!0},this);this.unbind(),this.el.bind("keyup.autoResize",t).bind("change.autoResize",t),this.check(null,!0)},unbind:function(){this.el.unbind(".autoResize")},createClone:function(){var n=this.el,r=this,i=this.config;this.clones=e();if(i.minHeight!=="original"||i.maxHeight!=="original")this.hClone=n.clone().height("auto"),this.clones=this.clones.add(this.hClone);if(i.minWidth!=="original"||i.maxWidth!=="original")this.wClone=e("<div/>").width("auto").css({whiteSpace:"nowrap","float":"left"}),this.clones=this.clones.add(this.wClone);e.each(t.cloneCSSProperties,function(e,t){r.clones.css(t,n.css(t))}),this.clones.removeAttr("name").removeAttr("id").attr("tabIndex",-1).css(t.cloneCSSValues)},check:function(e,t){var n=this.config,r=this.wClone,i=this.hClone,s=this.el,o=s.val();if(r){r.text(o);var u=r.outerWidth(),a=u+n.extraSpace>=n.minWidth?u+n.extraSpace:n.minWidth,f=s.width();a=Math.min(a,n.maxWidth);if(a<f&&a>=n.minWidth||a>=n.minWidth&&a<=n.maxWidth)n.onResize.call(s),s.scrollLeft(0),n.animate&&!t?s.stop(1,1).animate({width:a},n.animate):s.width(a)}if(i){a&&i.width(a),i.height(0).val(o).scrollTop(1e4);var l=i[0].scrollTop+n.extraSpace;if(this.previousScrollTop===l)return;this.previousScrollTop=l;if(l>=n.maxHeight){s.css("overflowY","");return}s.css("overflowY","hidden"),l<n.minHeight&&(l=n.minHeight),n.onResize.call(s),n.animate&&!t?s.stop(1,1).animate({height:l},n.animate):s.height(l)}},destroy:function(){this.unbind(),this.el.removeData("AutoResizer"),this.clones.remove(),delete this.el,delete this.hClone,delete this.wClone,delete this.clones},injectClone:function(){(t.cloneContainer||(t.cloneContainer=e("<arclones/>").appendTo("body"))).append(this.clones)}}}(jQuery),function(e){function i(n){var r=n||t.event,i=[].slice.call(arguments,1),s=0,o=!0,u=0,a=0;return n=e.event.fix(r),n.type="mousewheel",r.wheelDelta&&(s=r.wheelDelta/120),r.detail&&(s=-r.detail/3),a=s,r.axis!==undefined&&r.axis===r.HORIZONTAL_AXIS&&(a=0,u=-1*s),r.wheelDeltaY!==undefined&&(a=r.wheelDeltaY/120),r.wheelDeltaX!==undefined&&(u=-1*r.wheelDeltaX/120),i.unshift(n,s,u,a),(e.event.dispatch||e.event.handle).apply(this,i)}var n=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var r=n.length;r;)e.event.fixHooks[n[--r]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],i,!1);else this.onmousewheel=i},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],i,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery),function(e){function t(e){return e.split('"').length-1}e.SheetClip={parse:function(e){var n,r,i,s=[],o=0,u,a,f,l;i=e.split("\n"),i.length>1&&i[i.length-1]===""&&i.pop();for(n=0,r=i.length;n<r;n+=1){i[n]=i[n].split("	");for(u=0,a=i[n].length;u<a;u+=1)s[o]||(s[o]=[]),f&&u===0?(l=s[o].length-1,s[o][l]=s[o][l]+"\n"+i[n][0],f&&t(i[n][0])%2===1&&(f=!1,s[o][l]=s[o][l].substring(0,s[o][l].length-1).replace(/""/g,'"'))):u===a-1&&i[n][u].indexOf('"')===0?(s[o].push(i[n][u].substring(1).replace(/""/g,'"')),f=!0):(s[o].push(i[n][u].replace(/""/g,'"')),f=!1);f||(o+=1)}return s},stringify:function(e){var t,n,r,i,s="",o;for(t=0,n=e.length;t<n;t+=1){for(r=0,i=e[t].length;r<i;r+=1)r>0&&(s+="	"),o=e[t][r],typeof o=="string"?o.indexOf("\n")>-1?s+='"'+o.replace(/"/g,'""')+'"':s+=o:o===null||o===void 0?s+="":s+=o;s+="\n"}return s}}}(t)})(jQuery,window,Handsontable),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.$menu=e(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),(e.browser.chrome||e.browser.webkit||e.browser.msie)&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=!~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault(),n.typeahead(n.data())})})}(window.jQuery),function(e,t){function d(e){var t=e.split(/\s+/),n=[];for(var r=0,i;i=t[r];r++)i=i[0].toUpperCase(),n.push(i);return n}function v(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function m(n,r,i){return i||(i=0),r.each(function(){var r=e(this),s=this,o=this.nodeName.toLowerCase(),u,a;o=="label"&&r.find("input, textarea, select").length&&(u=r.text(),r=r.children().first(),s=r.get(0),o=s.nodeName.toLowerCase());switch(o){case"menu":a={name:r.attr("label"),items:{}},i=m(a.items,r.children(),i);break;case"a":case"button":a={name:r.text(),disabled:!!r.attr("disabled"),callback:function(){return function(){r.click()}}()};break;case"menuitem":case"command":switch(r.attr("type")){case t:case"command":case"menuitem":a={name:r.attr("label"),disabled:!!r.attr("disabled"),callback:function(){return function(){r.click()}}()};break;case"checkbox":a={type:"checkbox",disabled:!!r.attr("disabled"),name:r.attr("label"),selected:!!r.attr("checked")};break;case"radio":a={type:"radio",disabled:!!r.attr("disabled"),name:r.attr("label"),radio:r.attr("radiogroup"),value:r.attr("id"),selected:!!r.attr("checked")};break;default:a=t}break;case"hr":a="-------";break;case"input":switch(r.attr("type")){case"text":a={type:"text",name:u||v(s),disabled:!!r.attr("disabled"),value:r.val()};break;case"checkbox":a={type:"checkbox",name:u||v(s),disabled:!!r.attr("disabled"),selected:!!r.attr("checked")};break;case"radio":a={type:"radio",name:u||v(s),disabled:!!r.attr("disabled"),radio:!!r.attr("name"),value:r.val(),selected:!!r.attr("checked")};break;default:a=t}break;case"select":a={type:"select",name:u||v(s),disabled:!!r.attr("disabled"),selected:r.val(),options:{}},r.children().each(function(){a.options[this.value]=e(this).text()});break;case"textarea":a={type:"textarea",name:u||v(s),disabled:!!r.attr("disabled"),value:r.val()};break;case"label":break;default:a={type:"html",html:r.clone(!0)}}a&&(i++,n["key"+i]=a)}),i}e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement;var n=null,r=!1,i=e(window),s=0,o={},u={},a={},f={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(t,n,r){var s=this,o;if(!n&&!r){t.determinePosition.call(this,t.$menu);return}if(n==="maintain"&&r==="maintain")o=t.$menu.position();else{var u=t.$trigger.parents().andSelf().filter(function(){return e(this).css("position")=="fixed"}).length;u&&(r-=i.scrollTop(),n-=i.scrollLeft()),o={top:r,left:n}}var a=i.scrollTop()+i.height(),f=i.scrollLeft()+i.width(),l=t.$menu.height(),c=t.$menu.width();o.top+l>a&&(o.top-=l),o.left+c>f&&(o.left-=c),t.$menu.css(o)},positionSubmenu:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top",at:"right top",of:this,collision:"fit"}).css("display","");else{var n={top:0,left:this.outerWidth()};t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},l={timer:null,pageX:null,pageY:null},c=function(e){var t=0,n=e;for(;;){t=Math.max(t,parseInt(n.css("z-index"),10)||0),n=n.parent();if(!n||!n.length||"html body".indexOf(n.prop("nodeName").toLowerCase())>-1)break}return t},h={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var r=e(this);t.preventDefault(),t.stopImmediatePropagation();if(t.data.trigger!="right"&&t.originalEvent)return;if(!r.hasClass("context-menu-disabled")){n=r;if(t.data.build){var i=t.data.build(n,t);if(i===!1)return;t.data=e.extend(!0,{},f,t.data,i||{});if(!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),new Error("No Items sepcified");t.data.$trigger=n,p.create(t.data)}p.show.call(r,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var r=e(this);n&&n.length&&!n.is(r)&&n.data("contextMenu").$menu.trigger("contextmenu:hide"),t.button==2&&(n=r.data("contextMenuActive",!0))},mouseup:function(t){var r=e(this);r.data("contextMenuActive")&&n&&n.length&&n.is(r)&&!r.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),n=r,r.trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),r.removeData("contextMenuActive")},mouseenter:function(t){var r=e(this),i=e(t.relatedTarget),s=e(document);if(i.is(".context-menu-list")||i.closest(".context-menu-list").length)return;if(n&&n.length)return;l.pageX=t.pageX,l.pageY=t.pageY,l.data=t.data,s.on("mousemove.contextMenuShow",h.mousemove),l.timer=setTimeout(function(){l.timer=null,s.off("mousemove.contextMenuShow"),n=r,r.trigger(e.Event("contextmenu",{data:l.data,pageX:l.pageX,pageY:l.pageY}))},t.data.delay)},mousemove:function(e){l.pageX=e.pageX,l.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(n.is(".context-menu-list")||n.closest(".context-menu-list").length)return;try{clearTimeout(l.timer)}catch(t){}l.timer=null},layerClick:function(t){var n=e(this),r=n.data("contextMenuRoot"),s=!1,u=t.button,a=t.pageX,f=t.pageY,l,c,h;t.preventDefault(),t.stopImmediatePropagation(),n.on("mouseup",function(){s=!0}),setTimeout(function(){var p,d;if(r.trigger=="left"&&u==0||r.trigger=="right"&&u==2)if(document.elementFromPoint){r.$layer.hide(),l=document.elementFromPoint(a-i.scrollLeft(),f-i.scrollTop()),r.$layer.show(),h=[];for(var v in o)h.push(v);l=e(l).closest(h.join(", "));if(l.length&&l.is(r.$trigger[0])){r.position.call(r.$trigger,r,a,f);return}}else{c=r.$trigger.offset(),p=e(window),c.top+=p.scrollTop();if(c.top<=t.pageY){c.left+=p.scrollLeft();if(c.left<=t.pageX){c.bottom=c.top+r.$trigger.outerHeight();if(c.bottom>=t.pageY){c.right=c.left+r.$trigger.outerWidth();if(c.right>=t.pageX){r.position.call(r.$trigger,r,a,f);return}}}}}d=function(e){e&&(e.preventDefault(),e.stopImmediatePropagation()),r.$menu.trigger("contextmenu:hide"),l&&l.length&&setTimeout(function(){l.contextMenu({x:a,y:f})},50)},s?d():n.on("mouseup",d)},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t=n.data("contextMenu")||{},r=t.$menu.children(),i;switch(e.keyCode){case 9:case 38:h.keyStop(e,t);if(t.isInput){if(e.keyCode==9&&e.shiftKey){e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),t.$menu.trigger("prevcommand");return}if(e.keyCode==38&&t.$selected.find("input, textarea, select").prop("type")=="checkbox"){e.preventDefault();return}}else if(e.keyCode!=9||e.shiftKey){t.$menu.trigger("prevcommand");return};case 40:h.keyStop(e,t);if(!t.isInput){t.$menu.trigger("nextcommand");return}if(e.keyCode==9){e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),t.$menu.trigger("nextcommand");return}if(e.keyCode==40&&t.$selected.find("input, textarea, select").prop("type")=="checkbox"){e.preventDefault();return}break;case 37:h.keyStop(e,t);if(t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var s=t.$selected.parent().parent();t.$selected.trigger("contextmenu:blur"),t.$selected=s;return}break;case 39:h.keyStop(e,t);if(t.isInput||!t.$selected||!t.$selected.length)break;var o=t.$selected.data("contextMenu")||{};if(o.$menu&&t.$selected.hasClass("context-menu-submenu")){t.$selected=null,o.$selected=null,o.$menu.trigger("nextcommand");return}break;case 35:case 36:if(t.$selected&&t.$selected.find("input, textarea, select").length)return;(t.$selected&&t.$selected.parent()||t.$menu).children(":not(.disabled, .not-selectable)")[e.keyCode==36?"first":"last"]().trigger("contextmenu:focus"),e.preventDefault();return;case 13:h.keyStop(e,t);if(t.isInput){if(t.$selected&&!t.$selected.is("textarea, select")){e.preventDefault();return}break}t.$selected&&t.$selected.trigger("mouseup");return;case 32:case 33:case 34:h.keyStop(e,t);return;case 27:h.keyStop(e,t),t.$menu.trigger("contextmenu:hide");return;default:var u=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys[u]){t.accesskeys[u].$node.trigger(t.accesskeys[u].$menu?"contextmenu:focus":"mouseup");return}}e.stopPropagation(),t.$selected&&t.$selected.trigger(e)},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var r=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=r}var i=n.$menu.children(),s=!n.$selected||!n.$selected.prev().length?i.last():n.$selected.prev(),o=s;while(s.hasClass("disabled")||s.hasClass("not-selectable")){s.prev().length?s=s.prev():s=i.last();if(s.is(o))return}n.$selected&&h.itemMouseleave.call(n.$selected.get(0),t),h.itemMouseenter.call(s.get(0),t);var u=s.find("input, textarea, select");u.length&&u.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var r=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=r}var i=n.$menu.children(),s=!n.$selected||!n.$selected.next().length?i.first():n.$selected.next(),o=s;while(s.hasClass("disabled")||s.hasClass("not-selectable")){s.next().length?s=s.next():s=i.first();if(s.is(o))return}n.$selected&&h.itemMouseleave.call(n.$selected.get(0),t),h.itemMouseenter.call(s.get(0),t);var u=s.find("input, textarea, select");u.length&&u.focus()},focusInput:function(t){var n=e(this).closest(".context-menu-item"),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.$selected=i.$selected=n,s.isInput=i.isInput=!0},blurInput:function(t){var n=e(this).closest(".context-menu-item"),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.isInput=i.isInput=!1},menuMouseenter:function(t){var n=e(this).data().contextMenuRoot;n.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.hovering=!0,t&&s.$layer&&s.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(i.$menu?i:s).$menu.children(".hover").trigger("contextmenu:blur");if(n.hasClass("disabled")||n.hasClass("not-selectable")){i.$selected=null;return}n.trigger("contextmenu:focus")},itemMouseleave:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;if(s!==i&&s.$layer&&s.$layer.is(t.relatedTarget)){s.$selected&&s.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),s.$selected=i.$selected=i.$node;return}n.trigger("contextmenu:blur")},itemClick:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot,o=r.contextMenuKey,u;if(!i.items[o]||n.hasClass("disabled")||n.hasClass("context-menu-submenu"))return;t.preventDefault(),t.stopImmediatePropagation();if(e.isFunction(s.callbacks[o]))u=s.callbacks[o];else{if(!e.isFunction(s.callback))return;u=s.callback}u.call(s.$trigger,o,s)!==!1?s.$menu.trigger("contextmenu:hide"):s.$menu.parent().length&&p.update.call(s.$trigger,s)},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,n){var r=e(this).data("contextMenuRoot");p.hide.call(r.$trigger,r,n&&n.force)},focusItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.addClass("hover").siblings(".hover").trigger("contextmenu:blur"),i.$selected=s.$selected=n,i.$node&&s.positionSubmenu.call(i.$node,i.$menu)},blurItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.removeClass("hover"),i.$selected=null}},p={show:function(t,r,i){var s=e(this),o,u={};e("#context-menu-layer").trigger("mousedown"),t.$trigger=s;if(t.events.show.call(s,t)===!1){n=null;return}p.update.call(s,t),t.position.call(s,t,r,i),t.zIndex&&(u.zIndex=c(s)+t.zIndex),p.layer.call(t.$menu,t,u.zIndex),t.$menu.find("ul").css("zIndex",u.zIndex+1),t.$menu.css(u)[t.animation.show](t.animation.duration),s.data("contextMenu",t),e(document).off("keydown.contextMenu").on("keydown.contextMenu",h.key);if(t.autoHide){var a=s.position();a.right=a.left+s.outerWidth(),a.bottom=a.top+this.outerHeight(),e(document).on("mousemove.contextMenuAutoHide",function(e){t.$layer&&!t.hovering&&(!(e.pageX>=a.left&&e.pageX<=a.right)||!(e.pageY>=a.top&&e.pageY<=a.bottom))&&t.$menu.trigger("contextmenu:hide")})}},hide:function(r,i){var s=e(this);r||(r=s.data("contextMenu")||{});if(!i&&r.events&&r.events.hide.call(s,r)===!1)return;if(r.$layer){setTimeout(function(e){return function(){e.remove()}}(r.$layer),10);try{delete r.$layer}catch(o){r.$layer=null}}n=null,r.$menu.find(".hover").trigger("contextmenu:blur"),r.$selected=null,e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),r.$menu&&r.$menu[r.animation.hide](r.animation.duration,function(){r.build&&(r.$menu.remove(),e.each(r,function(e,n){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:r[e]=t;try{delete r[e]}catch(i){}return!0}}))})},create:function(n,r){r===t&&(r=n),n.$menu=e('<ul class="context-menu-list '+(n.className||"")+'"></ul>').data({contextMenu:n,contextMenuRoot:r}),e.each(["callbacks","commands","inputs"],function(e,t){n[t]={},r[t]||(r[t]={})}),r.accesskeys||(r.accesskeys={}),e.each(n.items,function(t,i){var s=e('<li class="context-menu-item '+(i.className||"")+'"></li>'),o=null,u=null;i.$node=s.data({contextMenu:n,contextMenuRoot:r,contextMenuKey:t});if(i.accesskey){var f=d(i.accesskey);for(var l=0,c;c=f[l];l++)if(!r.accesskeys[c]){r.accesskeys[c]=i,i._name=i.name.replace(new RegExp("("+c+")","i"),'<span class="context-menu-accesskey">$1</span>');break}}if(typeof i=="string")s.addClass("context-menu-separator not-selectable");else if(i.type&&a[i.type])a[i.type].call(s,i,n,r),e.each([n,r],function(n,r){r.commands[t]=i,e.isFunction(i.callback)&&(r.callbacks[t]=i.callback)});else{i.type=="html"?s.addClass("context-menu-html not-selectable"):i.type?(o=e("<label></label>").appendTo(s),e("<span></span>").html(i._name||i.name).appendTo(o),s.addClass("context-menu-input"),n.hasTypes=!0,e.each([n,r],function(e,n){n.commands[t]=i,n.inputs[t]=i})):i.items&&(i.type="sub");switch(i.type){case"text":u=e('<input type="text" value="1" name="context-menu-input-'+t+'" value="">').val(i.value||"").appendTo(o);break;case"textarea":u=e('<textarea name="context-menu-input-'+t+'"></textarea>').val(i.value||"").appendTo(o),i.height&&u.height(i.height);break;case"checkbox":u=e('<input type="checkbox" value="1" name="context-menu-input-'+t+'" value="">').val(i.value||"").prop("checked",!!i.selected).prependTo(o);break;case"radio":u=e('<input type="radio" value="1" name="context-menu-input-'+i.radio+'" value="">').val(i.value||"").prop("checked",!!i.selected).prependTo(o);break;case"select":u=e('<select name="context-menu-input-'+t+'">').appendTo(o),i.options&&(e.each(i.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(u)}),u.val(i.selected));break;case"sub":e("<span></span>").html(i._name||i.name).appendTo(s),i.appendTo=i.$node,p.create(i,r),s.data("contextMenu",i).addClass("context-menu-submenu"),i.callback=null;break;case"html":e(i.html).appendTo(s);break;default:e.each([n,r],function(n,r){r.commands[t]=i,e.isFunction(i.callback)&&(r.callbacks[t]=i.callback)}),e("<span></span>").html(i._name||i.name||"").appendTo(s)}i.type&&i.type!="sub"&&i.type!="html"&&(u.on("focus",h.focusInput).on("blur",h.blurInput),i.events&&u.on(i.events,n)),i.icon&&s.addClass("icon icon-"+i.icon)}i.$input=u,i.$label=o,s.appendTo(n.$menu),!n.hasTypes&&e.support.eventSelectstart&&s.on("selectstart.disableTextSelect",h.abortevent)}),n.$node||n.$menu.css("display","none").addClass("context-menu-root"),n.$menu.appendTo(n.appendTo||document.body)},update:function(n,r){var i=this;r===t&&(r=n,n.$menu.find("ul").andSelf().css({position:"static",display:"block"}).each(function(){var t=e(this);t.width(t.css("position","absolute").width()).css("position","static")}).css({position:"",display:""})),n.$menu.children().each(function(){var t=e(this),s=t.data("contextMenuKey"),o=n.items[s],u=e.isFunction(o.disabled)&&o.disabled.call(i,s,r)||o.disabled===!0;t[u?"addClass":"removeClass"]("disabled");if(o.type){t.find("input, select, textarea").prop("disabled",u);switch(o.type){case"text":case"textarea":o.$input.val(o.value||"");break;case"checkbox":case"radio":o.$input.val(o.value||"").prop("checked",!!o.selected);break;case"select":o.$input.val(o.selected||"")}}o.$menu&&p.update.call(i,o,r)})},layer:function(t,n){var r=t.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+n+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:i.height(),width:i.width(),display:"block"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",h.abortevent).on("mousedown",h.layerClick);return e.support.fixedPosition||r.css({position:"absolute",height:e(document).height()}),r}};e.fn.contextMenu=function(n){if(n===t)this.first().trigger("contextmenu");else if(n.x&&n.y)this.first().trigger(e.Event("contextmenu",{pageX:n.x,pageY:n.y}));else if(n==="hide"){var r=this.data("contextMenu").$menu;r&&r.trigger("contextmenu:hide")}else n?this.removeClass("context-menu-disabled"):n||this.addClass("context-menu-disabled");return this},e.contextMenu=function(n,i){typeof n!="string"&&(i=n,n="create"),typeof i=="string"?i={selector:i}:i===t&&(i={});var a=e.extend(!0,{},f,i||{}),l=e(document);switch(n){case"create":if(!a.selector)throw new Error("No selector specified");if(a.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+a.selector+'" as it contains a reserved className');if(!a.build&&(!a.items||e.isEmptyObject(a.items)))throw new Error("No Items sepcified");s++,a.ns=".contextMenu"+s,o[a.selector]=a.ns,u[a.ns]=a,a.trigger||(a.trigger="right"),r||(l.on({"contextmenu:hide.contextMenu":h.hideMenu,"prevcommand.contextMenu":h.prevItem,"nextcommand.contextMenu":h.nextItem,"contextmenu.contextMenu":h.abortevent,"mouseenter.contextMenu":h.menuMouseenter,"mouseleave.contextMenu":h.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",h.inputClick).on({"mouseup.contextMenu":h.itemClick,"contextmenu:focus.contextMenu":h.focusItem,"contextmenu:blur.contextMenu":h.blurItem,"contextmenu.contextMenu":h.abortevent,"mouseenter.contextMenu":h.itemMouseenter,"mouseleave.contextMenu":h.itemMouseleave},".context-menu-item"),r=!0),l.on("contextmenu"+a.ns,a.selector,a,h.contextmenu);switch(a.trigger){case"hover":l.on("mouseenter"+a.ns,a.selector,a,h.mouseenter).on("mouseleave"+a.ns,a.selector,a,h.mouseleave);break;case"left":l.on("click"+a.ns,a.selector,a,h.click)}a.build||p.create(a);break;case"destroy":if(!a.selector)l.off(".contextMenu .contextMenuAutoHide"),e.each(o,function(e,t){l.off(t)}),o={},u={},s=0,r=!1,e("#context-menu-layer, .context-menu-list").remove();else if(o[a.selector]){var c=e(".context-menu-list").filter(":visible");c.length&&c.data().contextMenuRoot.$trigger.is(a.selector)&&c.trigger("contextmenu:hide",{force:!0});try{u[o[a.selector]].$menu&&u[o[a.selector]].$menu.remove(),delete u[o[a.selector]]}catch(d){u[o[a.selector]]=null}l.off(o[a.selector])}break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||typeof i=="boolean"&&i)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+n+'"')}return this},e.contextMenu.setInputValues=function(n,r){r===t&&(r={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=r[e]||"";break;case"checkbox":t.selected=r[e]?!0:!1;break;case"radio":t.selected=(r[t.radio]||"")==t.value?!0:!1;break;case"select":t.selected=r[e]||""}})},e.contextMenu.getInputValues=function(n,r){return r===t&&(r={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":r[e]=t.$input.val();break;case"checkbox":r[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(r[t.radio]=t.value)}}),r},e.contextMenu.fromMenu=function(t){var n=e(t),r={};return m(r,n.children()),r},e.contextMenu.defaults=f,e.contextMenu.types=a}(jQuery),function(e,t){function h(e,t,n){return[parseInt(e[0],10)*(l.test(e[0])?t/100:1),parseInt(e[1],10)*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+%?/,f=/^\w+/,l=/%$/,c=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t)return n;var r,i,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var n,l,d,v,m,g=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),w=g[0],E=(t.collision||"flip").split(" "),S={};return w.nodeType===9?(l=g.width(),d=g.height(),v={top:0,left:0}):e.isWindow(w)?(l=g.width(),d=g.height(),v={top:g.scrollTop(),left:g.scrollLeft()}):w.preventDefault?(t.at="left top",l=d=0,v={top:w.pageY,left:w.pageX}):(l=g.outerWidth(),d=g.outerHeight(),v=g.offset()),m=e.extend({},v),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]),e[0]=o.test(e[0])?e[0]:"center",e[1]=u.test(e[1])?e[1]:"center",n=a.exec(e[0]),r=a.exec(e[1]),S[this]=[n?n[0]:0,r?r[0]:0],t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]}),E.length===1&&(E[1]=E[0]),t.at[0]==="right"?m.left+=l:t.at[0]==="center"&&(m.left+=l/2),t.at[1]==="bottom"?m.top+=d:t.at[1]==="center"&&(m.top+=d/2),n=h(S.at,l,d),m.left+=n[0],m.top+=n[1],this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),w=p(this,"marginLeft"),x=p(this,"marginTop"),T=f+w+p(this,"marginRight")+b.width,N=c+x+p(this,"marginBottom")+b.height,C=e.extend({},m),k=h(S.my,a.outerWidth(),a.outerHeight());t.my[0]==="right"?C.left-=f:t.my[0]==="center"&&(C.left-=f/2),t.my[1]==="bottom"?C.top-=c:t.my[1]==="center"&&(C.top-=c/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top)),o={marginLeft:w,marginTop:x},e.each(["left","top"],function(r,i){e.ui.position[E[r]]&&e.ui.position[E[r]][i](C,{targetWidth:l,targetHeight:d,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:y,elem:a})}),e.fn.bgiframe&&a.bgiframe(),t.using&&(u=function(e){var n=v.left-C.left,s=n+l-f,o=v.top-C.top,u=o+d-c,h={target:{element:g,left:v.left,top:v.top,width:l,height:d},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};l<f&&i(n+s)<l&&(h.horizontal="center"),d<c&&i(o+u)<d&&(h.vertical="middle"),r(i(n),i(s))>r(i(o),i(u))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h)}),a.offset(e.extend(C,{using:u}))})},e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;t.collisionWidth>s?u>0&&a<=0?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):a>0&&u<=0?e.left=i:u>a?e.left=i+s-t.collisionWidth:e.left=i:u>0?e.left+=u:a>0?e.left-=a:e.left=r(e.left-o,e.left)},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;t.collisionHeight>s?u>0&&a<=0?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):a>0&&u<=0?e.top=i:u>a?e.top=i+s-t.collisionHeight:e.top=i:u>0?e.top+=u:a>0?e.top-=a:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-s-r;if(p<0||p<i(a))e.left+=l+c+h}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-o;if(d>0||i(d)<f)e.left+=l+c+h}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(v<0||v<i(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(d>0||i(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t)}(),e.uiBackCompat!==!1&&function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset)return n.call(this,r);var i=r.offset.split(" "),s=r.at.split(" ");return i.length===1&&(i[1]=i[0]),/^\d/.test(i[0])&&(i[0]="+"+i[0]),/^\d/.test(i[1])&&(i[1]="+"+i[1]),s.length===1&&(/left|center|right/.test(s[0])?s[1]="center":(s[1]=s[0],s[0]="center")),n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}))}}(jQuery)}(jQuery);