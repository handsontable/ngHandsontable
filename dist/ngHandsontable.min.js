/**
 * ngHandsontable 0.5.1
 * 
 * Copyright 2012-2014 Marcin Warpechowski
 * Licensed under the MIT license.
 * https://github.com/handsontable/ngHandsontable
 * Date: Tue Jan 20 2015 14:51:24 GMT+0100 (CET)
*/

document.all&&!document.addEventListener&&(document.createElement("hot-table"),document.createElement("hot-column"),document.createElement("hot-autocomplete")),angular.module("ngHandsontable",["ngHandsontable.services","ngHandsontable.directives"]),angular.module("ngHandsontable.services",[]).factory("settingFactory",[function(){return{containerClassName:"handsontable-container",initializeHandsontable:function(a,b){var c=document.createElement("DIV");return c.className=this.containerClassName,a[0].appendChild(c),new Handsontable(c,b)},updateHandsontableSettings:function(a,b){a&&a.updateSettings(b)},renderHandsontable:function(a){a&&a.render()},setHandsontableSettingsFromScope:function(a,b){var c,d={},e=angular.extend({},b);angular.extend(e,b.settings);for(c in a)a.hasOwnProperty(c)&&"undefined"!=typeof e[a[c]]&&(d[a[c]]=e[a[c]]);return d},getScopeDefinition:function(a){for(var b={datarows:"=",settings:"="},c=0,d=a.length;d>c;c++)b[a[c]]="="+a[c].toLowerCase();return b}}}]).factory("autoCompleteFactory",[function(){return{parseAutoComplete:function(a,b,c,d){b.source=function(e,f){var g=a.getSelected()[0],h=[],i=c[g];if(i){var j=b.optionList;if(j.object){if(angular.isArray(j.object))h=j.object;else{for(var k=j.object.split("."),l=i;k.length>0;){var m=k.shift();l=l[m]}if(d)for(var n=0,o=l.length;o>n;n++)h.push(l[n][j.property]);else h=l}f(h)}}}}}}]),angular.module("ngHandsontable.directives",[]).directive("hotTable",["settingFactory","autoCompleteFactory","$rootScope","$parse",function(a,b,c,d){var e=Object.keys(Handsontable.DefaultSettings.prototype),f=Object.keys(Handsontable.PluginHooks.hooks),g=e.concat(f);return{restrict:"EA",scope:a.getScopeDefinition(g),controller:["$scope",function(a){this.setColumnSetting=function(b){a.htSettings||(a.htSettings={}),a.htSettings.columns||(a.htSettings.columns=[]),a.htSettings.columns.push(b)}}],link:function(e,f,h){if(e.htSettings||(e.htSettings={}),e.htSettings.data=e.datarows,angular.extend(e.htSettings,a.setHandsontableSettingsFromScope(g,e)),e.hotInstance=a.initializeHandsontable(f,e.htSettings),e.htSettings.columns){for(var i=0,j=e.htSettings.columns.length;j>i;i++)if("autocomplete"==e.htSettings.columns[i].type){if("string"==typeof e.htSettings.columns[i].optionList){var k={},l=e.htSettings.columns[i].optionList.match(/^\s*(.+)\s+in\s+(.*)\s*$/);l?(k.property=l[1],k.object=l[2]):k.object=k,e.htSettings.columns[i].optionList=k}b.parseAutoComplete(e.hotInstance,e.htSettings.columns[i],e.datarows,!0)}e.hotInstance.updateSettings(e.htSettings)}e.htSettings.afterChange=function(){c.$$phase||e.$apply()};var m=h.columns;e.$parent.$watch(function(){var a=e.$parent;return m?angular.toJson(d(m)(a)):void 0},function(){angular.extend(e.htSettings,a.setHandsontableSettingsFromScope(g,e.$parent)),a.updateHandsontableSettings(e.hotInstance,e.htSettings)}),e.$parent.$watch(function(){var a=e.$parent;return angular.toJson(d(h.datarows)(a))},function(){a.renderHandsontable(e.hotInstance)}),e.$watch("datarows",function(b,c){c.length==e.htSettings.minSpareRows&&b.length!=e.htSettings.minSpareRows&&(e.htSettings.data=e.datarows,a.updateHandsontableSettings(e.hotInstance,e.htSettings))})}}}]).directive("hotColumn",[function(){return{restrict:"E",require:"^hotTable",scope:{},controller:["$scope",function(a){this.setColumnOptionList=function(b){a.column||(a.column={});var c={},d=b.match(/^\s*(.+)\s+in\s+(.*)\s*$/);d?(c.property=d[1],c.object=d[2]):c.object=b.split(","),a.column.optionList=c}}],link:function(a,b,c,d){var e={};for(var f in c)c.hasOwnProperty(f)&&"$"!==f.charAt(0)&&"undefined"==typeof e[f]&&("data"===f?e.data=c[f]:e[f]=a.$eval(c[f]));switch(e.type){case"checkbox":"undefined"!=typeof c.checkedtemplate&&(e.checkedTemplate=a.$eval(c.checkedtemplate)),"undefined"!=typeof c.uncheckedtemplate&&(e.uncheckedTemplate=a.$eval(c.uncheckedtemplate))}"undefined"!=typeof c.readonly&&(e.readOnly=!0),a.column||(a.column={}),angular.extend(a.column,e),d.setColumnSetting(a.column)}}}]).directive("hotAutocomplete",[function(){return{restrict:"E",scope:!0,require:"^hotColumn",link:function(a,b,c,d){var e=c.datarows;d.setColumnOptionList(e)}}}]);